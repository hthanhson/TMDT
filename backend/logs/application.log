2025-04-16 01:30:31,507 DEBUG org.springframework.security.web.context.SecurityContextPersistenceFilter [http-nio-8080-exec-9] Cleared SecurityContextHolder to complete request
2025-04-16 01:30:31,517 INFO com.example.tmdt.filter.RequestLoggingFilter [http-nio-8080-exec-9] RESPONSE: Status=200, Time=34ms
2025-04-16 01:30:34,409 INFO com.example.tmdt.filter.RequestLoggingFilter [http-nio-8080-exec-7] REQUEST: OPTIONS /api/chat/sessions
2025-04-16 01:30:34,409 INFO com.example.tmdt.filter.RequestLoggingFilter [http-nio-8080-exec-7] HEADERS: host=localhost:8080, connection=keep-alive, accept=*/*, access-control-request-method=POST, access-control-request-headers=authorization,content-type, origin=http://localhost:3000, user-agent=Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/135.0.0.0 Safari/537.36 Edg/135.0.0.0, sec-fetch-mode=cors, sec-fetch-site=same-site, sec-fetch-dest=empty, referer=http://localhost:3000/, accept-encoding=gzip, deflate, br, zstd, accept-language=en-GB,en;q=0.9,en-US;q=0.8
2025-04-16 01:30:34,410 INFO com.example.tmdt.filter.RequestLoggingFilter [http-nio-8080-exec-7] RESPONSE: Status=200 (OK - CORS Preflight)
2025-04-16 01:30:34,411 INFO com.example.tmdt.filter.RequestLoggingFilter [http-nio-8080-exec-1] REQUEST: POST /api/chat/sessions
2025-04-16 01:30:34,412 INFO com.example.tmdt.filter.RequestLoggingFilter [http-nio-8080-exec-1] HEADERS: host=localhost:8080, connection=keep-alive, content-length=75, sec-ch-ua-platform="Windows", authorization=Bearer eyJhbGciOiJIUzUxMiJ9.eyJzdWIiOiJhMTIzNCIsImlhdCI6MTc0NDY5NDMyNiwiZXhwIjoxNzQ0NzgwNzI2fQ.BdO_Lx19STWajtL_3aPG3UAE47IcXqtg1lV-UsokSSyxYrD8OsPsjBjyrl34GZLD6RHpWE6LJTqDJyQ8OfBUWw, user-agent=Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/135.0.0.0 Safari/537.36 Edg/135.0.0.0, accept=application/json, text/plain, */*, sec-ch-ua="Microsoft Edge";v="135", "Not-A.Brand";v="8", "Chromium";v="135", content-type=application/json, sec-ch-ua-mobile=?0, origin=http://localhost:3000, sec-fetch-site=same-site, sec-fetch-mode=cors, sec-fetch-dest=empty, referer=http://localhost:3000/, accept-encoding=gzip, deflate, br, zstd, accept-language=en-GB,en;q=0.9,en-US;q=0.8
2025-04-16 01:30:34,412 DEBUG org.springframework.security.web.FilterChainProxy [http-nio-8080-exec-1] Securing POST /api/chat/sessions?currentUserId=3
2025-04-16 01:30:34,412 DEBUG org.springframework.security.web.context.SecurityContextPersistenceFilter [http-nio-8080-exec-1] Set SecurityContextHolder to empty SecurityContext
2025-04-16 01:30:34,412 DEBUG com.example.tmdt.security.jwt.AuthTokenFilter [http-nio-8080-exec-1] Processing request to URL: /api/chat/sessions, Method: POST
2025-04-16 01:30:34,412 DEBUG com.example.tmdt.security.jwt.AuthTokenFilter [http-nio-8080-exec-1] Authorization header: Bearer eyJhbGciOiJIUzUxMiJ9.eyJzdWIiOiJhMTIzNCIsImlhdCI6MTc0NDY5NDMyNiwiZXhwIjoxNzQ0NzgwNzI2fQ.BdO_Lx19STWajtL_3aPG3UAE47IcXqtg1lV-UsokSSyxYrD8OsPsjBjyrl34GZLD6RHpWE6LJTqDJyQ8OfBUWw
2025-04-16 01:30:34,412 DEBUG com.example.tmdt.security.jwt.AuthTokenFilter [http-nio-8080-exec-1] Found Authorization header with Bearer token
2025-04-16 01:30:34,412 DEBUG com.example.tmdt.security.jwt.AuthTokenFilter [http-nio-8080-exec-1] Found JWT token in request: eyJhbGciOiJIUzUxMiJ9.eyJzdWIiOiJhMTIzNCIsImlhdCI6MTc0NDY5NDMyNiwiZXhwIjoxNzQ0NzgwNzI2fQ.BdO_Lx19STWajtL_3aPG3UAE47IcXqtg1lV-UsokSSyxYrD8OsPsjBjyrl34GZLD6RHpWE6LJTqDJyQ8OfBUWw
2025-04-16 01:30:34,412 DEBUG com.example.tmdt.security.jwt.JwtUtils [http-nio-8080-exec-1] JWT token validation successful
2025-04-16 01:30:34,413 DEBUG com.example.tmdt.security.jwt.JwtUtils [http-nio-8080-exec-1] Extracted username from JWT token: a1234
2025-04-16 01:30:34,413 DEBUG com.example.tmdt.security.jwt.AuthTokenFilter [http-nio-8080-exec-1] Valid JWT token found for user: a1234
2025-04-16 01:30:34,414 DEBUG org.hibernate.engine.jdbc.spi.SqlStatementLogger [http-nio-8080-exec-1] 
    select
        user0_.id as id1_19_,
        user0_.address as address2_19_,
        user0_.email as email3_19_,
        user0_.full_name as full_nam4_19_,
        user0_.password as password5_19_,
        user0_.phone_number as phone_nu6_19_,
        user0_.username as username7_19_ 
    from
        users user0_ 
    where
        user0_.username=?
2025-04-16 01:30:34,415 TRACE org.hibernate.type.descriptor.sql.BasicBinder [http-nio-8080-exec-1] binding parameter [1] as [VARCHAR] - [a1234]
2025-04-16 01:30:34,416 DEBUG org.hibernate.engine.jdbc.spi.SqlStatementLogger [http-nio-8080-exec-1] 
    select
        userbalanc0_.id as id1_15_0_,
        userbalanc0_.balance as balance2_15_0_,
        userbalanc0_.created_at as created_3_15_0_,
        userbalanc0_.last_deposit_date as last_dep4_15_0_,
        userbalanc0_.last_withdrawal_date as last_wit5_15_0_,
        userbalanc0_.updated_at as updated_6_15_0_,
        userbalanc0_.user_id as user_id7_15_0_ 
    from
        user_balances userbalanc0_ 
    where
        userbalanc0_.user_id=?
2025-04-16 01:30:34,416 TRACE org.hibernate.type.descriptor.sql.BasicBinder [http-nio-8080-exec-1] binding parameter [1] as [BIGINT] - [3]
2025-04-16 01:30:34,417 DEBUG org.hibernate.engine.jdbc.spi.SqlStatementLogger [http-nio-8080-exec-1] 
    select
        roles0_.user_id as user_id1_18_0_,
        roles0_.role_id as role_id2_18_0_,
        role1_.id as id1_14_1_,
        role1_.name as name2_14_1_ 
    from
        user_roles roles0_ 
    inner join
        roles role1_ 
            on roles0_.role_id=role1_.id 
    where
        roles0_.user_id=?
2025-04-16 01:30:34,417 TRACE org.hibernate.type.descriptor.sql.BasicBinder [http-nio-8080-exec-1] binding parameter [1] as [BIGINT] - [3]
2025-04-16 01:30:34,418 DEBUG com.example.tmdt.security.jwt.AuthTokenFilter [http-nio-8080-exec-1] User details loaded for: a1234, User class: com.example.tmdt.security.services.UserDetailsImpl
2025-04-16 01:30:34,419 DEBUG com.example.tmdt.security.jwt.AuthTokenFilter [http-nio-8080-exec-1] User authorities: [ROLE_USER]
2025-04-16 01:30:34,419 DEBUG com.example.tmdt.security.jwt.AuthTokenFilter [http-nio-8080-exec-1] Set authentication for user: a1234 with authorities: [ROLE_USER]
2025-04-16 01:30:34,419 DEBUG com.example.tmdt.security.jwt.AuthTokenFilter [http-nio-8080-exec-1] Authentication set in SecurityContext: UsernamePasswordAuthenticationToken [Principal=com.example.tmdt.security.services.UserDetailsImpl@7b556961, Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=null], Granted Authorities=[ROLE_USER]], Principal class: com.example.tmdt.security.services.UserDetailsImpl
2025-04-16 01:30:34,419 DEBUG org.springframework.security.web.FilterChainProxy$VirtualFilterChain [http-nio-8080-exec-1] Secured POST /api/chat/sessions?currentUserId=3
2025-04-16 01:30:34,420 DEBUG com.example.tmdt.utils.LoggerUtil [http-nio-8080-exec-1] ENTERING createChatSession with args: [{userId=3, username=a1234, isAnonymous=false, requestSupport=true}]
2025-04-16 01:30:34,420 INFO com.example.tmdt.controller.ChatController [http-nio-8080-exec-1] Creating chat session for user 3
2025-04-16 01:30:34,421 INFO com.example.tmdt.controller.ChatController [http-nio-8080-exec-1] User 3 is anonymous: false
2025-04-16 01:30:34,422 DEBUG org.hibernate.engine.jdbc.spi.SqlStatementLogger [http-nio-8080-exec-1] 
    select
        chatsessio0_.id as id1_3_,
        chatsessio0_.ended_at as ended_at2_3_,
        chatsessio0_.last_message as last_mes3_3_,
        chatsessio0_.started_at as started_4_3_,
        chatsessio0_.status as status5_3_,
        chatsessio0_.unread_count as unread_c6_3_,
        chatsessio0_.user_id as user_id7_3_,
        chatsessio0_.user_name as user_nam8_3_ 
    from
        chat_sessions chatsessio0_ 
    where
        chatsessio0_.user_id=? 
        and chatsessio0_.status=?
2025-04-16 01:30:34,423 TRACE org.hibernate.type.descriptor.sql.BasicBinder [http-nio-8080-exec-1] binding parameter [1] as [VARCHAR] - [3]
2025-04-16 01:30:34,423 TRACE org.hibernate.type.descriptor.sql.BasicBinder [http-nio-8080-exec-1] binding parameter [2] as [VARCHAR] - [ACTIVE]
2025-04-16 01:30:34,435 DEBUG org.hibernate.engine.jdbc.spi.SqlStatementLogger [http-nio-8080-exec-1] 
    select
        chatsessio0_.id as id1_3_0_,
        chatsessio0_.ended_at as ended_at2_3_0_,
        chatsessio0_.last_message as last_mes3_3_0_,
        chatsessio0_.started_at as started_4_3_0_,
        chatsessio0_.status as status5_3_0_,
        chatsessio0_.unread_count as unread_c6_3_0_,
        chatsessio0_.user_id as user_id7_3_0_,
        chatsessio0_.user_name as user_nam8_3_0_ 
    from
        chat_sessions chatsessio0_ 
    where
        chatsessio0_.id=?
2025-04-16 01:30:34,435 TRACE org.hibernate.type.descriptor.sql.BasicBinder [http-nio-8080-exec-1] binding parameter [1] as [VARCHAR] - [22d50efd-edeb-47b3-a3bc-59661a84f74e]
2025-04-16 01:30:34,438 DEBUG org.hibernate.engine.jdbc.spi.SqlStatementLogger [http-nio-8080-exec-1] 
    insert 
    into
        chat_sessions
        (ended_at, last_message, started_at, status, unread_count, user_id, user_name, id) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-04-16 01:30:34,439 TRACE org.hibernate.type.descriptor.sql.BasicBinder [http-nio-8080-exec-1] binding parameter [1] as [TIMESTAMP] - [null]
2025-04-16 01:30:34,439 TRACE org.hibernate.type.descriptor.sql.BasicBinder [http-nio-8080-exec-1] binding parameter [2] as [VARCHAR] - [null]
2025-04-16 01:30:34,439 TRACE org.hibernate.type.descriptor.sql.BasicBinder [http-nio-8080-exec-1] binding parameter [3] as [TIMESTAMP] - [2025-04-16T01:30:34.437514200]
2025-04-16 01:30:34,440 TRACE org.hibernate.type.descriptor.sql.BasicBinder [http-nio-8080-exec-1] binding parameter [4] as [VARCHAR] - [ACTIVE]
2025-04-16 01:30:34,440 TRACE org.hibernate.type.descriptor.sql.BasicBinder [http-nio-8080-exec-1] binding parameter [5] as [INTEGER] - [0]
2025-04-16 01:30:34,440 TRACE org.hibernate.type.descriptor.sql.BasicBinder [http-nio-8080-exec-1] binding parameter [6] as [VARCHAR] - [3]
2025-04-16 01:30:34,440 TRACE org.hibernate.type.descriptor.sql.BasicBinder [http-nio-8080-exec-1] binding parameter [7] as [VARCHAR] - [a1234]
2025-04-16 01:30:34,440 TRACE org.hibernate.type.descriptor.sql.BasicBinder [http-nio-8080-exec-1] binding parameter [8] as [VARCHAR] - [22d50efd-edeb-47b3-a3bc-59661a84f74e]
2025-04-16 01:30:34,445 INFO com.example.tmdt.controller.ChatController [http-nio-8080-exec-1] Created chat session 22d50efd-edeb-47b3-a3bc-59661a84f74e for user 3 (anonymous: false)
2025-04-16 01:30:34,445 DEBUG com.example.tmdt.utils.LoggerUtil [http-nio-8080-exec-1] EXITING createChatSession with result: [<200 OK OK,ChatSession(id=22d50efd-edeb-47b3-a3bc-59661a84f74e, userId=3, userName=a1234, startedAt=2025-04-16T01:30:34.437514200, endedAt=null, status=ACTIVE, lastMessage=null, unreadCount=0),[]>]
2025-04-16 01:30:34,446 DEBUG com.example.tmdt.utils.LoggerUtil [http-nio-8080-exec-1] Method createChatSession executed in 26 ms
2025-04-16 01:30:34,446 DEBUG org.springframework.security.web.context.SecurityContextPersistenceFilter [http-nio-8080-exec-1] Cleared SecurityContextHolder to complete request
2025-04-16 01:30:34,446 INFO com.example.tmdt.filter.RequestLoggingFilter [http-nio-8080-exec-1] RESPONSE: Status=200, Time=34ms
2025-04-16 01:30:34,449 INFO com.example.tmdt.filter.RequestLoggingFilter [http-nio-8080-exec-6] REQUEST: OPTIONS /api/chat/sessions/22d50efd-edeb-47b3-a3bc-59661a84f74e
2025-04-16 01:30:34,449 INFO com.example.tmdt.filter.RequestLoggingFilter [http-nio-8080-exec-6] HEADERS: host=localhost:8080, connection=keep-alive, accept=*/*, access-control-request-method=GET, access-control-request-headers=authorization, origin=http://localhost:3000, user-agent=Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/135.0.0.0 Safari/537.36 Edg/135.0.0.0, sec-fetch-mode=cors, sec-fetch-site=same-site, sec-fetch-dest=empty, referer=http://localhost:3000/, accept-encoding=gzip, deflate, br, zstd, accept-language=en-GB,en;q=0.9,en-US;q=0.8
2025-04-16 01:30:34,449 INFO com.example.tmdt.filter.RequestLoggingFilter [http-nio-8080-exec-6] RESPONSE: Status=200 (OK - CORS Preflight)
2025-04-16 01:30:34,451 INFO com.example.tmdt.filter.RequestLoggingFilter [http-nio-8080-exec-8] REQUEST: GET /api/chat/sessions/22d50efd-edeb-47b3-a3bc-59661a84f74e
2025-04-16 01:30:34,451 INFO com.example.tmdt.filter.RequestLoggingFilter [http-nio-8080-exec-8] HEADERS: host=localhost:8080, connection=keep-alive, sec-ch-ua-platform="Windows", authorization=Bearer eyJhbGciOiJIUzUxMiJ9.eyJzdWIiOiJhMTIzNCIsImlhdCI6MTc0NDY5NDMyNiwiZXhwIjoxNzQ0NzgwNzI2fQ.BdO_Lx19STWajtL_3aPG3UAE47IcXqtg1lV-UsokSSyxYrD8OsPsjBjyrl34GZLD6RHpWE6LJTqDJyQ8OfBUWw, user-agent=Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/135.0.0.0 Safari/537.36 Edg/135.0.0.0, accept=application/json, text/plain, */*, sec-ch-ua="Microsoft Edge";v="135", "Not-A.Brand";v="8", "Chromium";v="135", sec-ch-ua-mobile=?0, origin=http://localhost:3000, sec-fetch-site=same-site, sec-fetch-mode=cors, sec-fetch-dest=empty, referer=http://localhost:3000/, accept-encoding=gzip, deflate, br, zstd, accept-language=en-GB,en;q=0.9,en-US;q=0.8
2025-04-16 01:30:34,451 DEBUG org.springframework.security.web.FilterChainProxy [http-nio-8080-exec-8] Securing GET /api/chat/sessions/22d50efd-edeb-47b3-a3bc-59661a84f74e?currentUserId=3
2025-04-16 01:30:34,451 DEBUG org.springframework.security.web.context.SecurityContextPersistenceFilter [http-nio-8080-exec-8] Set SecurityContextHolder to empty SecurityContext
2025-04-16 01:30:34,451 DEBUG com.example.tmdt.security.jwt.AuthTokenFilter [http-nio-8080-exec-8] Processing request to URL: /api/chat/sessions/22d50efd-edeb-47b3-a3bc-59661a84f74e, Method: GET
2025-04-16 01:30:34,451 DEBUG com.example.tmdt.security.jwt.AuthTokenFilter [http-nio-8080-exec-8] Authorization header: Bearer eyJhbGciOiJIUzUxMiJ9.eyJzdWIiOiJhMTIzNCIsImlhdCI6MTc0NDY5NDMyNiwiZXhwIjoxNzQ0NzgwNzI2fQ.BdO_Lx19STWajtL_3aPG3UAE47IcXqtg1lV-UsokSSyxYrD8OsPsjBjyrl34GZLD6RHpWE6LJTqDJyQ8OfBUWw
2025-04-16 01:30:34,451 DEBUG com.example.tmdt.security.jwt.AuthTokenFilter [http-nio-8080-exec-8] Found Authorization header with Bearer token
2025-04-16 01:30:34,451 DEBUG com.example.tmdt.security.jwt.AuthTokenFilter [http-nio-8080-exec-8] Found JWT token in request: eyJhbGciOiJIUzUxMiJ9.eyJzdWIiOiJhMTIzNCIsImlhdCI6MTc0NDY5NDMyNiwiZXhwIjoxNzQ0NzgwNzI2fQ.BdO_Lx19STWajtL_3aPG3UAE47IcXqtg1lV-UsokSSyxYrD8OsPsjBjyrl34GZLD6RHpWE6LJTqDJyQ8OfBUWw
2025-04-16 01:30:34,452 DEBUG com.example.tmdt.security.jwt.JwtUtils [http-nio-8080-exec-8] JWT token validation successful
2025-04-16 01:30:34,452 DEBUG com.example.tmdt.security.jwt.JwtUtils [http-nio-8080-exec-8] Extracted username from JWT token: a1234
2025-04-16 01:30:34,452 DEBUG com.example.tmdt.security.jwt.AuthTokenFilter [http-nio-8080-exec-8] Valid JWT token found for user: a1234
2025-04-16 01:30:34,453 DEBUG org.hibernate.engine.jdbc.spi.SqlStatementLogger [http-nio-8080-exec-8] 
    select
        user0_.id as id1_19_,
        user0_.address as address2_19_,
        user0_.email as email3_19_,
        user0_.full_name as full_nam4_19_,
        user0_.password as password5_19_,
        user0_.phone_number as phone_nu6_19_,
        user0_.username as username7_19_ 
    from
        users user0_ 
    where
        user0_.username=?
2025-04-16 01:30:34,453 TRACE org.hibernate.type.descriptor.sql.BasicBinder [http-nio-8080-exec-8] binding parameter [1] as [VARCHAR] - [a1234]
2025-04-16 01:30:34,454 DEBUG org.hibernate.engine.jdbc.spi.SqlStatementLogger [http-nio-8080-exec-8] 
    select
        userbalanc0_.id as id1_15_0_,
        userbalanc0_.balance as balance2_15_0_,
        userbalanc0_.created_at as created_3_15_0_,
        userbalanc0_.last_deposit_date as last_dep4_15_0_,
        userbalanc0_.last_withdrawal_date as last_wit5_15_0_,
        userbalanc0_.updated_at as updated_6_15_0_,
        userbalanc0_.user_id as user_id7_15_0_ 
    from
        user_balances userbalanc0_ 
    where
        userbalanc0_.user_id=?
2025-04-16 01:30:34,454 TRACE org.hibernate.type.descriptor.sql.BasicBinder [http-nio-8080-exec-8] binding parameter [1] as [BIGINT] - [3]
2025-04-16 01:30:34,456 DEBUG org.hibernate.engine.jdbc.spi.SqlStatementLogger [http-nio-8080-exec-8] 
    select
        roles0_.user_id as user_id1_18_0_,
        roles0_.role_id as role_id2_18_0_,
        role1_.id as id1_14_1_,
        role1_.name as name2_14_1_ 
    from
        user_roles roles0_ 
    inner join
        roles role1_ 
            on roles0_.role_id=role1_.id 
    where
        roles0_.user_id=?
2025-04-16 01:30:34,457 TRACE org.hibernate.type.descriptor.sql.BasicBinder [http-nio-8080-exec-8] binding parameter [1] as [BIGINT] - [3]
2025-04-16 01:30:34,458 DEBUG com.example.tmdt.security.jwt.AuthTokenFilter [http-nio-8080-exec-8] User details loaded for: a1234, User class: com.example.tmdt.security.services.UserDetailsImpl
2025-04-16 01:30:34,458 DEBUG com.example.tmdt.security.jwt.AuthTokenFilter [http-nio-8080-exec-8] User authorities: [ROLE_USER]
2025-04-16 01:30:34,458 DEBUG com.example.tmdt.security.jwt.AuthTokenFilter [http-nio-8080-exec-8] Set authentication for user: a1234 with authorities: [ROLE_USER]
2025-04-16 01:30:34,458 DEBUG com.example.tmdt.security.jwt.AuthTokenFilter [http-nio-8080-exec-8] Authentication set in SecurityContext: UsernamePasswordAuthenticationToken [Principal=com.example.tmdt.security.services.UserDetailsImpl@65c7da3e, Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=null], Granted Authorities=[ROLE_USER]], Principal class: com.example.tmdt.security.services.UserDetailsImpl
2025-04-16 01:30:34,458 DEBUG org.springframework.security.web.FilterChainProxy$VirtualFilterChain [http-nio-8080-exec-8] Secured GET /api/chat/sessions/22d50efd-edeb-47b3-a3bc-59661a84f74e?currentUserId=3
2025-04-16 01:30:34,459 DEBUG com.example.tmdt.utils.LoggerUtil [http-nio-8080-exec-8] ENTERING getChatSessionById with args: [22d50efd-edeb-47b3-a3bc-59661a84f74e]
2025-04-16 01:30:34,460 DEBUG org.hibernate.engine.jdbc.spi.SqlStatementLogger [http-nio-8080-exec-8] 
    select
        chatsessio0_.id as id1_3_0_,
        chatsessio0_.ended_at as ended_at2_3_0_,
        chatsessio0_.last_message as last_mes3_3_0_,
        chatsessio0_.started_at as started_4_3_0_,
        chatsessio0_.status as status5_3_0_,
        chatsessio0_.unread_count as unread_c6_3_0_,
        chatsessio0_.user_id as user_id7_3_0_,
        chatsessio0_.user_name as user_nam8_3_0_ 
    from
        chat_sessions chatsessio0_ 
    where
        chatsessio0_.id=?
2025-04-16 01:30:34,460 TRACE org.hibernate.type.descriptor.sql.BasicBinder [http-nio-8080-exec-8] binding parameter [1] as [VARCHAR] - [22d50efd-edeb-47b3-a3bc-59661a84f74e]
2025-04-16 01:30:34,461 DEBUG com.example.tmdt.utils.LoggerUtil [http-nio-8080-exec-8] EXITING getChatSessionById with result: [<200 OK OK,ChatSession(id=22d50efd-edeb-47b3-a3bc-59661a84f74e, userId=3, userName=a1234, startedAt=2025-04-16T01:30:34, endedAt=null, status=ACTIVE, lastMessage=null, unreadCount=0),[]>]
2025-04-16 01:30:34,462 DEBUG com.example.tmdt.utils.LoggerUtil [http-nio-8080-exec-8] Method getChatSessionById executed in 3 ms
2025-04-16 01:30:34,463 DEBUG org.springframework.security.web.context.SecurityContextPersistenceFilter [http-nio-8080-exec-8] Cleared SecurityContextHolder to complete request
2025-04-16 01:30:34,463 INFO com.example.tmdt.filter.RequestLoggingFilter [http-nio-8080-exec-8] RESPONSE: Status=200, Time=12ms
2025-04-16 01:30:34,471 INFO com.example.tmdt.filter.RequestLoggingFilter [http-nio-8080-exec-2] REQUEST: POST /api/chat/messages
2025-04-16 01:30:34,472 INFO com.example.tmdt.filter.RequestLoggingFilter [http-nio-8080-exec-2] HEADERS: host=localhost:8080, connection=keep-alive, content-length=126, sec-ch-ua-platform="Windows", authorization=Bearer eyJhbGciOiJIUzUxMiJ9.eyJzdWIiOiJhMTIzNCIsImlhdCI6MTc0NDY5NDMyNiwiZXhwIjoxNzQ0NzgwNzI2fQ.BdO_Lx19STWajtL_3aPG3UAE47IcXqtg1lV-UsokSSyxYrD8OsPsjBjyrl34GZLD6RHpWE6LJTqDJyQ8OfBUWw, user-agent=Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/135.0.0.0 Safari/537.36 Edg/135.0.0.0, accept=application/json, text/plain, */*, sec-ch-ua="Microsoft Edge";v="135", "Not-A.Brand";v="8", "Chromium";v="135", content-type=application/json, sec-ch-ua-mobile=?0, origin=http://localhost:3000, sec-fetch-site=same-site, sec-fetch-mode=cors, sec-fetch-dest=empty, referer=http://localhost:3000/, accept-encoding=gzip, deflate, br, zstd, accept-language=en-GB,en;q=0.9,en-US;q=0.8
2025-04-16 01:30:34,472 INFO com.example.tmdt.websocket.ChatWebSocketHandler [http-nio-8089-exec-31] WebSocket connection closed: e701e4d6-6116-5076-913a-a989b4c21621 with status CloseStatus[code=1000, reason=null]
2025-04-16 01:30:34,472 DEBUG org.springframework.security.web.FilterChainProxy [http-nio-8080-exec-2] Securing POST /api/chat/messages?currentUserId=3
2025-04-16 01:30:34,472 INFO com.example.tmdt.websocket.ChatWebSocketHandler [http-nio-8089-exec-31] Found chat session ID 9eb630d7-f522-41bb-9942-7c8f198fe01f for closed WebSocket session
2025-04-16 01:30:34,472 DEBUG org.springframework.security.web.context.SecurityContextPersistenceFilter [http-nio-8080-exec-2] Set SecurityContextHolder to empty SecurityContext
2025-04-16 01:30:34,472 INFO com.example.tmdt.websocket.ChatWebSocketHandler [http-nio-8089-exec-31] User 3 with session 9eb630d7-f522-41bb-9942-7c8f198fe01f disconnected
2025-04-16 01:30:34,472 INFO com.example.tmdt.websocket.ChatWebSocketHandler [http-nio-8089-exec-31] Notifying admins that user 3 has disconnected
2025-04-16 01:30:34,472 INFO com.example.tmdt.websocket.ChatWebSocketHandler [http-nio-8089-exec-31] Current number of admin sessions: 1
2025-04-16 01:30:34,472 INFO com.example.tmdt.websocket.ChatWebSocketHandler [http-nio-8089-exec-31] Sending USER_DISCONNECTED notification to admin 2: {"type":"USER_DISCONNECTED","userId":"3","timestamp":1744741834472}
2025-04-16 01:30:34,472 DEBUG com.example.tmdt.security.jwt.AuthTokenFilter [http-nio-8080-exec-2] Processing request to URL: /api/chat/messages, Method: POST
2025-04-16 01:30:34,472 INFO com.example.tmdt.websocket.ChatWebSocketHandler [http-nio-8089-exec-31] Successfully sent user disconnect notification to 1 admin(s)
2025-04-16 01:30:34,472 DEBUG com.example.tmdt.security.jwt.AuthTokenFilter [http-nio-8080-exec-2] Authorization header: Bearer eyJhbGciOiJIUzUxMiJ9.eyJzdWIiOiJhMTIzNCIsImlhdCI6MTc0NDY5NDMyNiwiZXhwIjoxNzQ0NzgwNzI2fQ.BdO_Lx19STWajtL_3aPG3UAE47IcXqtg1lV-UsokSSyxYrD8OsPsjBjyrl34GZLD6RHpWE6LJTqDJyQ8OfBUWw
2025-04-16 01:30:34,472 DEBUG com.example.tmdt.security.jwt.AuthTokenFilter [http-nio-8080-exec-2] Found Authorization header with Bearer token
2025-04-16 01:30:34,472 DEBUG com.example.tmdt.security.jwt.AuthTokenFilter [http-nio-8080-exec-2] Found JWT token in request: eyJhbGciOiJIUzUxMiJ9.eyJzdWIiOiJhMTIzNCIsImlhdCI6MTc0NDY5NDMyNiwiZXhwIjoxNzQ0NzgwNzI2fQ.BdO_Lx19STWajtL_3aPG3UAE47IcXqtg1lV-UsokSSyxYrD8OsPsjBjyrl34GZLD6RHpWE6LJTqDJyQ8OfBUWw
2025-04-16 01:30:34,472 DEBUG com.example.tmdt.security.jwt.JwtUtils [http-nio-8080-exec-2] JWT token validation successful
2025-04-16 01:30:34,473 DEBUG com.example.tmdt.security.jwt.JwtUtils [http-nio-8080-exec-2] Extracted username from JWT token: a1234
2025-04-16 01:30:34,473 DEBUG com.example.tmdt.security.jwt.AuthTokenFilter [http-nio-8080-exec-2] Valid JWT token found for user: a1234
2025-04-16 01:30:34,473 DEBUG org.hibernate.engine.jdbc.spi.SqlStatementLogger [http-nio-8080-exec-2] 
    select
        user0_.id as id1_19_,
        user0_.address as address2_19_,
        user0_.email as email3_19_,
        user0_.full_name as full_nam4_19_,
        user0_.password as password5_19_,
        user0_.phone_number as phone_nu6_19_,
        user0_.username as username7_19_ 
    from
        users user0_ 
    where
        user0_.username=?
2025-04-16 01:30:34,474 TRACE org.hibernate.type.descriptor.sql.BasicBinder [http-nio-8080-exec-2] binding parameter [1] as [VARCHAR] - [a1234]
2025-04-16 01:30:34,475 DEBUG org.hibernate.engine.jdbc.spi.SqlStatementLogger [http-nio-8080-exec-2] 
    select
        userbalanc0_.id as id1_15_0_,
        userbalanc0_.balance as balance2_15_0_,
        userbalanc0_.created_at as created_3_15_0_,
        userbalanc0_.last_deposit_date as last_dep4_15_0_,
        userbalanc0_.last_withdrawal_date as last_wit5_15_0_,
        userbalanc0_.updated_at as updated_6_15_0_,
        userbalanc0_.user_id as user_id7_15_0_ 
    from
        user_balances userbalanc0_ 
    where
        userbalanc0_.user_id=?
2025-04-16 01:30:34,475 INFO com.example.tmdt.filter.RequestLoggingFilter [http-nio-8080-exec-5] REQUEST: GET /api/chat/sessions/active
2025-04-16 01:30:34,475 TRACE org.hibernate.type.descriptor.sql.BasicBinder [http-nio-8080-exec-2] binding parameter [1] as [BIGINT] - [3]
2025-04-16 01:30:34,475 INFO com.example.tmdt.filter.RequestLoggingFilter [http-nio-8080-exec-5] HEADERS: host=localhost:8080, connection=keep-alive, sec-ch-ua-platform="Windows", authorization=Bearer eyJhbGciOiJIUzUxMiJ9.eyJzdWIiOiJhZG1pbiIsImlhdCI6MTc0NDczMTMzOSwiZXhwIjoxNzQ0ODE3NzM5fQ.v-t4oABHhkaDi26bHf9oNlBgDITHxwLTyyO6o-6cY9ctKD3wySIuuJ8Ug1erRaTivtrcXJmKE20M5XdQn9Kciw, user-agent=Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/135.0.0.0 Safari/537.36 Edg/135.0.0.0, accept=application/json, text/plain, */*, sec-ch-ua="Microsoft Edge";v="135", "Not-A.Brand";v="8", "Chromium";v="135", sec-ch-ua-mobile=?0, origin=http://localhost:3001, sec-fetch-site=same-site, sec-fetch-mode=cors, sec-fetch-dest=empty, referer=http://localhost:3001/, accept-encoding=gzip, deflate, br, zstd, accept-language=en-GB,en;q=0.9,en-US;q=0.8
2025-04-16 01:30:34,475 DEBUG org.springframework.security.web.FilterChainProxy [http-nio-8080-exec-5] Securing GET /api/chat/sessions/active?currentUserId=2
2025-04-16 01:30:34,475 DEBUG org.springframework.security.web.context.SecurityContextPersistenceFilter [http-nio-8080-exec-5] Set SecurityContextHolder to empty SecurityContext
2025-04-16 01:30:34,476 DEBUG com.example.tmdt.security.jwt.AuthTokenFilter [http-nio-8080-exec-5] Processing request to URL: /api/chat/sessions/active, Method: GET
2025-04-16 01:30:34,476 DEBUG com.example.tmdt.security.jwt.AuthTokenFilter [http-nio-8080-exec-5] Authorization header: Bearer eyJhbGciOiJIUzUxMiJ9.eyJzdWIiOiJhZG1pbiIsImlhdCI6MTc0NDczMTMzOSwiZXhwIjoxNzQ0ODE3NzM5fQ.v-t4oABHhkaDi26bHf9oNlBgDITHxwLTyyO6o-6cY9ctKD3wySIuuJ8Ug1erRaTivtrcXJmKE20M5XdQn9Kciw
2025-04-16 01:30:34,476 DEBUG com.example.tmdt.security.jwt.AuthTokenFilter [http-nio-8080-exec-5] Found Authorization header with Bearer token
2025-04-16 01:30:34,476 DEBUG com.example.tmdt.security.jwt.AuthTokenFilter [http-nio-8080-exec-5] Found JWT token in request: eyJhbGciOiJIUzUxMiJ9.eyJzdWIiOiJhZG1pbiIsImlhdCI6MTc0NDczMTMzOSwiZXhwIjoxNzQ0ODE3NzM5fQ.v-t4oABHhkaDi26bHf9oNlBgDITHxwLTyyO6o-6cY9ctKD3wySIuuJ8Ug1erRaTivtrcXJmKE20M5XdQn9Kciw
2025-04-16 01:30:34,477 DEBUG com.example.tmdt.security.jwt.JwtUtils [http-nio-8080-exec-5] JWT token validation successful
2025-04-16 01:30:34,476 DEBUG org.hibernate.engine.jdbc.spi.SqlStatementLogger [http-nio-8080-exec-2] 
    select
        roles0_.user_id as user_id1_18_0_,
        roles0_.role_id as role_id2_18_0_,
        role1_.id as id1_14_1_,
        role1_.name as name2_14_1_ 
    from
        user_roles roles0_ 
    inner join
        roles role1_ 
            on roles0_.role_id=role1_.id 
    where
        roles0_.user_id=?
2025-04-16 01:30:34,477 DEBUG com.example.tmdt.security.jwt.JwtUtils [http-nio-8080-exec-5] Extracted username from JWT token: admin
2025-04-16 01:30:34,477 DEBUG com.example.tmdt.security.jwt.AuthTokenFilter [http-nio-8080-exec-5] Valid JWT token found for user: admin
2025-04-16 01:30:34,477 TRACE org.hibernate.type.descriptor.sql.BasicBinder [http-nio-8080-exec-2] binding parameter [1] as [BIGINT] - [3]
2025-04-16 01:30:34,478 DEBUG org.hibernate.engine.jdbc.spi.SqlStatementLogger [http-nio-8080-exec-5] 
    select
        user0_.id as id1_19_,
        user0_.address as address2_19_,
        user0_.email as email3_19_,
        user0_.full_name as full_nam4_19_,
        user0_.password as password5_19_,
        user0_.phone_number as phone_nu6_19_,
        user0_.username as username7_19_ 
    from
        users user0_ 
    where
        user0_.username=?
2025-04-16 01:30:34,478 TRACE org.hibernate.type.descriptor.sql.BasicBinder [http-nio-8080-exec-5] binding parameter [1] as [VARCHAR] - [admin]
2025-04-16 01:30:34,479 DEBUG com.example.tmdt.security.jwt.AuthTokenFilter [http-nio-8080-exec-2] User details loaded for: a1234, User class: com.example.tmdt.security.services.UserDetailsImpl
2025-04-16 01:30:34,479 DEBUG com.example.tmdt.security.jwt.AuthTokenFilter [http-nio-8080-exec-2] User authorities: [ROLE_USER]
2025-04-16 01:30:34,479 DEBUG com.example.tmdt.security.jwt.AuthTokenFilter [http-nio-8080-exec-2] Set authentication for user: a1234 with authorities: [ROLE_USER]
2025-04-16 01:30:34,479 DEBUG org.hibernate.engine.jdbc.spi.SqlStatementLogger [http-nio-8080-exec-5] 
    select
        userbalanc0_.id as id1_15_0_,
        userbalanc0_.balance as balance2_15_0_,
        userbalanc0_.created_at as created_3_15_0_,
        userbalanc0_.last_deposit_date as last_dep4_15_0_,
        userbalanc0_.last_withdrawal_date as last_wit5_15_0_,
        userbalanc0_.updated_at as updated_6_15_0_,
        userbalanc0_.user_id as user_id7_15_0_ 
    from
        user_balances userbalanc0_ 
    where
        userbalanc0_.user_id=?
2025-04-16 01:30:34,479 DEBUG com.example.tmdt.security.jwt.AuthTokenFilter [http-nio-8080-exec-2] Authentication set in SecurityContext: UsernamePasswordAuthenticationToken [Principal=com.example.tmdt.security.services.UserDetailsImpl@688d3318, Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=null], Granted Authorities=[ROLE_USER]], Principal class: com.example.tmdt.security.services.UserDetailsImpl
2025-04-16 01:30:34,479 DEBUG org.springframework.security.web.FilterChainProxy$VirtualFilterChain [http-nio-8080-exec-2] Secured POST /api/chat/messages?currentUserId=3
2025-04-16 01:30:34,479 TRACE org.hibernate.type.descriptor.sql.BasicBinder [http-nio-8080-exec-5] binding parameter [1] as [BIGINT] - [2]
2025-04-16 01:30:34,480 DEBUG org.hibernate.engine.jdbc.spi.SqlStatementLogger [http-nio-8080-exec-5] 
    select
        roles0_.user_id as user_id1_18_0_,
        roles0_.role_id as role_id2_18_0_,
        role1_.id as id1_14_1_,
        role1_.name as name2_14_1_ 
    from
        user_roles roles0_ 
    inner join
        roles role1_ 
            on roles0_.role_id=role1_.id 
    where
        roles0_.user_id=?
2025-04-16 01:30:34,480 DEBUG com.example.tmdt.utils.LoggerUtil [http-nio-8080-exec-2] ENTERING saveMessage with args: [{content=s, senderId=3, senderName=a1234, senderType=USER, chatSessionId=22d50efd-edeb-47b3-a3bc-59661a84f74e}]
2025-04-16 01:30:34,480 TRACE org.hibernate.type.descriptor.sql.BasicBinder [http-nio-8080-exec-5] binding parameter [1] as [BIGINT] - [2]
2025-04-16 01:30:34,480 DEBUG com.example.tmdt.controller.ChatController [http-nio-8080-exec-2] Saving message with payload: {content=s, senderId=3, senderName=a1234, senderType=USER, chatSessionId=22d50efd-edeb-47b3-a3bc-59661a84f74e}
2025-04-16 01:30:34,481 DEBUG org.hibernate.engine.jdbc.spi.SqlStatementLogger [http-nio-8080-exec-2] 
    select
        count(*) as col_0_0_ 
    from
        chat_sessions chatsessio0_ 
    where
        chatsessio0_.id=?
2025-04-16 01:30:34,481 TRACE org.hibernate.type.descriptor.sql.BasicBinder [http-nio-8080-exec-2] binding parameter [1] as [VARCHAR] - [22d50efd-edeb-47b3-a3bc-59661a84f74e]
2025-04-16 01:30:34,482 DEBUG com.example.tmdt.security.jwt.AuthTokenFilter [http-nio-8080-exec-5] User details loaded for: admin, User class: com.example.tmdt.security.services.UserDetailsImpl
2025-04-16 01:30:34,482 DEBUG com.example.tmdt.security.jwt.AuthTokenFilter [http-nio-8080-exec-5] User authorities: [ROLE_ADMIN]
2025-04-16 01:30:34,482 DEBUG com.example.tmdt.security.jwt.AuthTokenFilter [http-nio-8080-exec-5] Set authentication for user: admin with authorities: [ROLE_ADMIN]
2025-04-16 01:30:34,482 DEBUG com.example.tmdt.security.jwt.AuthTokenFilter [http-nio-8080-exec-5] Authentication set in SecurityContext: UsernamePasswordAuthenticationToken [Principal=com.example.tmdt.security.services.UserDetailsImpl@57fb0ef3, Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=null], Granted Authorities=[ROLE_ADMIN]], Principal class: com.example.tmdt.security.services.UserDetailsImpl
2025-04-16 01:30:34,483 DEBUG org.springframework.security.web.FilterChainProxy$VirtualFilterChain [http-nio-8080-exec-5] Secured GET /api/chat/sessions/active?currentUserId=2
2025-04-16 01:30:34,483 DEBUG org.springframework.security.authorization.method.AuthorizationManagerBeforeMethodInterceptor [http-nio-8080-exec-5] Authorizing method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity com.example.tmdt.controller.ChatController.getActiveChatSessions(); target is of class [com.example.tmdt.controller.ChatController]
2025-04-16 01:30:34,483 DEBUG org.hibernate.engine.jdbc.spi.SqlStatementLogger [http-nio-8080-exec-2] 
    insert 
    into
        chat_messages
        (chat_session_id, content, created_at, is_read, receiver_id, sender_id, sender_name, sender_type) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-04-16 01:30:34,484 DEBUG org.springframework.security.authorization.method.AuthorizationManagerBeforeMethodInterceptor [http-nio-8080-exec-5] Authorized method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity com.example.tmdt.controller.ChatController.getActiveChatSessions(); target is of class [com.example.tmdt.controller.ChatController]
2025-04-16 01:30:34,484 DEBUG com.example.tmdt.utils.LoggerUtil [http-nio-8080-exec-5] ENTERING getActiveChatSessions
2025-04-16 01:30:34,484 INFO com.example.tmdt.controller.ChatController [http-nio-8080-exec-5] Getting active chat sessions
2025-04-16 01:30:34,484 INFO com.example.tmdt.service.ChatService [http-nio-8080-exec-5] Getting active chat sessions from repository
2025-04-16 01:30:34,484 TRACE org.hibernate.type.descriptor.sql.BasicBinder [http-nio-8080-exec-2] binding parameter [1] as [VARCHAR] - [22d50efd-edeb-47b3-a3bc-59661a84f74e]
2025-04-16 01:30:34,484 TRACE org.hibernate.type.descriptor.sql.BasicBinder [http-nio-8080-exec-2] binding parameter [2] as [VARCHAR] - [s]
2025-04-16 01:30:34,484 TRACE org.hibernate.type.descriptor.sql.BasicBinder [http-nio-8080-exec-2] binding parameter [3] as [TIMESTAMP] - [2025-04-16T01:30:34.483519900]
2025-04-16 01:30:34,484 DEBUG org.hibernate.engine.jdbc.spi.SqlStatementLogger [http-nio-8080-exec-5] 
    select
        chatsessio0_.id as id1_3_,
        chatsessio0_.ended_at as ended_at2_3_,
        chatsessio0_.last_message as last_mes3_3_,
        chatsessio0_.started_at as started_4_3_,
        chatsessio0_.status as status5_3_,
        chatsessio0_.unread_count as unread_c6_3_,
        chatsessio0_.user_id as user_id7_3_,
        chatsessio0_.user_name as user_nam8_3_ 
    from
        chat_sessions chatsessio0_ 
    where
        chatsessio0_.status=? 
    order by
        chatsessio0_.started_at desc
2025-04-16 01:30:34,484 TRACE org.hibernate.type.descriptor.sql.BasicBinder [http-nio-8080-exec-2] binding parameter [4] as [BOOLEAN] - [false]
2025-04-16 01:30:34,485 TRACE org.hibernate.type.descriptor.sql.BasicBinder [http-nio-8080-exec-2] binding parameter [5] as [VARCHAR] - [null]
2025-04-16 01:30:34,485 TRACE org.hibernate.type.descriptor.sql.BasicBinder [http-nio-8080-exec-5] binding parameter [1] as [VARCHAR] - [ACTIVE]
2025-04-16 01:30:34,485 TRACE org.hibernate.type.descriptor.sql.BasicBinder [http-nio-8080-exec-2] binding parameter [6] as [VARCHAR] - [3]
2025-04-16 01:30:34,485 TRACE org.hibernate.type.descriptor.sql.BasicBinder [http-nio-8080-exec-2] binding parameter [7] as [VARCHAR] - [a1234]
2025-04-16 01:30:34,485 TRACE org.hibernate.type.descriptor.sql.BasicBinder [http-nio-8080-exec-2] binding parameter [8] as [VARCHAR] - [USER]
2025-04-16 01:30:34,486 INFO com.example.tmdt.controller.ChatController [http-nio-8080-exec-5] Found 1 active sessions
2025-04-16 01:30:34,486 DEBUG com.example.tmdt.utils.LoggerUtil [http-nio-8080-exec-5] EXITING getActiveChatSessions with result: [<200 OK OK,[ChatSession(id=22d50efd-edeb-47b3-a3bc-59661a84f74e, userId=3, userName=a1234, startedAt=2025-04-16T01:30:34, endedAt=null, status=ACTIVE, lastMessage=null, unreadCount=0)],[]>]
2025-04-16 01:30:34,486 DEBUG com.example.tmdt.utils.LoggerUtil [http-nio-8080-exec-5] Method getActiveChatSessions executed in 2 ms
2025-04-16 01:30:34,487 DEBUG org.springframework.security.web.context.SecurityContextPersistenceFilter [http-nio-8080-exec-5] Cleared SecurityContextHolder to complete request
2025-04-16 01:30:34,487 INFO com.example.tmdt.filter.RequestLoggingFilter [http-nio-8080-exec-5] RESPONSE: Status=200, Time=12ms
2025-04-16 01:30:34,488 DEBUG org.hibernate.engine.jdbc.spi.SqlStatementLogger [http-nio-8080-exec-2] 
    select
        chatsessio0_.id as id1_3_0_,
        chatsessio0_.ended_at as ended_at2_3_0_,
        chatsessio0_.last_message as last_mes3_3_0_,
        chatsessio0_.started_at as started_4_3_0_,
        chatsessio0_.status as status5_3_0_,
        chatsessio0_.unread_count as unread_c6_3_0_,
        chatsessio0_.user_id as user_id7_3_0_,
        chatsessio0_.user_name as user_nam8_3_0_ 
    from
        chat_sessions chatsessio0_ 
    where
        chatsessio0_.id=?
2025-04-16 01:30:34,488 TRACE org.hibernate.type.descriptor.sql.BasicBinder [http-nio-8080-exec-2] binding parameter [1] as [VARCHAR] - [22d50efd-edeb-47b3-a3bc-59661a84f74e]
2025-04-16 01:30:34,490 DEBUG org.hibernate.engine.jdbc.spi.SqlStatementLogger [http-nio-8080-exec-2] 
    update
        chat_sessions 
    set
        ended_at=?,
        last_message=?,
        started_at=?,
        status=?,
        unread_count=?,
        user_id=?,
        user_name=? 
    where
        id=?
2025-04-16 01:30:34,491 TRACE org.hibernate.type.descriptor.sql.BasicBinder [http-nio-8080-exec-2] binding parameter [1] as [TIMESTAMP] - [null]
2025-04-16 01:30:34,492 TRACE org.hibernate.type.descriptor.sql.BasicBinder [http-nio-8080-exec-2] binding parameter [2] as [VARCHAR] - [s]
2025-04-16 01:30:34,492 TRACE org.hibernate.type.descriptor.sql.BasicBinder [http-nio-8080-exec-2] binding parameter [3] as [TIMESTAMP] - [2025-04-16T01:30:34]
2025-04-16 01:30:34,492 TRACE org.hibernate.type.descriptor.sql.BasicBinder [http-nio-8080-exec-2] binding parameter [4] as [VARCHAR] - [ACTIVE]
2025-04-16 01:30:34,492 TRACE org.hibernate.type.descriptor.sql.BasicBinder [http-nio-8080-exec-2] binding parameter [5] as [INTEGER] - [1]
2025-04-16 01:30:34,492 TRACE org.hibernate.type.descriptor.sql.BasicBinder [http-nio-8080-exec-2] binding parameter [6] as [VARCHAR] - [3]
2025-04-16 01:30:34,492 TRACE org.hibernate.type.descriptor.sql.BasicBinder [http-nio-8080-exec-2] binding parameter [7] as [VARCHAR] - [a1234]
2025-04-16 01:30:34,492 TRACE org.hibernate.type.descriptor.sql.BasicBinder [http-nio-8080-exec-2] binding parameter [8] as [VARCHAR] - [22d50efd-edeb-47b3-a3bc-59661a84f74e]
2025-04-16 01:30:34,494 INFO com.example.tmdt.service.ChatService [http-nio-8080-exec-2] Updated lastMessage for session 22d50efd-edeb-47b3-a3bc-59661a84f74e: s
2025-04-16 01:30:34,495 INFO com.example.tmdt.controller.ChatController [http-nio-8080-exec-2] Message saved successfully with ID 410
2025-04-16 01:30:34,495 DEBUG com.example.tmdt.utils.LoggerUtil [http-nio-8080-exec-2] EXITING saveMessage with result: [<200 OK OK,ChatMessage(id=410, content=s, senderId=3, senderName=a1234, receiverId=null, senderType=USER, chatSessionId=22d50efd-edeb-47b3-a3bc-59661a84f74e, createdAt=2025-04-16T01:30:34.483519900, read=false),[]>]
2025-04-16 01:30:34,495 DEBUG com.example.tmdt.utils.LoggerUtil [http-nio-8080-exec-2] Method saveMessage executed in 15 ms
2025-04-16 01:30:34,496 DEBUG org.springframework.security.web.context.SecurityContextPersistenceFilter [http-nio-8080-exec-2] Cleared SecurityContextHolder to complete request
2025-04-16 01:30:34,496 INFO com.example.tmdt.filter.RequestLoggingFilter [http-nio-8080-exec-2] RESPONSE: Status=200, Time=24ms
2025-04-16 01:30:34,516 INFO com.example.tmdt.filter.RequestLoggingFilter [http-nio-8080-exec-9] REQUEST: OPTIONS /api/chat/messages/system
2025-04-16 01:30:34,516 INFO com.example.tmdt.filter.RequestLoggingFilter [http-nio-8080-exec-9] HEADERS: host=localhost:8080, connection=keep-alive, accept=*/*, access-control-request-method=POST, access-control-request-headers=authorization,content-type, origin=http://localhost:3000, user-agent=Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/135.0.0.0 Safari/537.36 Edg/135.0.0.0, sec-fetch-mode=cors, sec-fetch-site=same-site, sec-fetch-dest=empty, referer=http://localhost:3000/, accept-encoding=gzip, deflate, br, zstd, accept-language=en-GB,en;q=0.9,en-US;q=0.8
2025-04-16 01:30:34,516 INFO com.example.tmdt.filter.RequestLoggingFilter [http-nio-8080-exec-9] RESPONSE: Status=200 (OK - CORS Preflight)
2025-04-16 01:30:34,518 INFO com.example.tmdt.filter.RequestLoggingFilter [http-nio-8080-exec-3] REQUEST: POST /api/chat/messages/system
2025-04-16 01:30:34,518 INFO com.example.tmdt.filter.RequestLoggingFilter [http-nio-8080-exec-3] HEADERS: host=localhost:8080, connection=keep-alive, content-length=140, sec-ch-ua-platform="Windows", authorization=Bearer eyJhbGciOiJIUzUxMiJ9.eyJzdWIiOiJhMTIzNCIsImlhdCI6MTc0NDY5NDMyNiwiZXhwIjoxNzQ0NzgwNzI2fQ.BdO_Lx19STWajtL_3aPG3UAE47IcXqtg1lV-UsokSSyxYrD8OsPsjBjyrl34GZLD6RHpWE6LJTqDJyQ8OfBUWw, user-agent=Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/135.0.0.0 Safari/537.36 Edg/135.0.0.0, accept=application/json, text/plain, */*, sec-ch-ua="Microsoft Edge";v="135", "Not-A.Brand";v="8", "Chromium";v="135", content-type=application/json, sec-ch-ua-mobile=?0, origin=http://localhost:3000, sec-fetch-site=same-site, sec-fetch-mode=cors, sec-fetch-dest=empty, referer=http://localhost:3000/, accept-encoding=gzip, deflate, br, zstd, accept-language=en-GB,en;q=0.9,en-US;q=0.8
2025-04-16 01:30:34,518 DEBUG org.springframework.security.web.FilterChainProxy [http-nio-8080-exec-3] Securing POST /api/chat/messages/system?currentUserId=3
2025-04-16 01:30:34,518 DEBUG org.springframework.security.web.context.SecurityContextPersistenceFilter [http-nio-8080-exec-3] Set SecurityContextHolder to empty SecurityContext
2025-04-16 01:30:34,518 DEBUG com.example.tmdt.security.jwt.AuthTokenFilter [http-nio-8080-exec-3] Processing request to URL: /api/chat/messages/system, Method: POST
2025-04-16 01:30:34,519 DEBUG com.example.tmdt.security.jwt.AuthTokenFilter [http-nio-8080-exec-3] Authorization header: Bearer eyJhbGciOiJIUzUxMiJ9.eyJzdWIiOiJhMTIzNCIsImlhdCI6MTc0NDY5NDMyNiwiZXhwIjoxNzQ0NzgwNzI2fQ.BdO_Lx19STWajtL_3aPG3UAE47IcXqtg1lV-UsokSSyxYrD8OsPsjBjyrl34GZLD6RHpWE6LJTqDJyQ8OfBUWw
2025-04-16 01:30:34,519 DEBUG com.example.tmdt.security.jwt.AuthTokenFilter [http-nio-8080-exec-3] Found Authorization header with Bearer token
2025-04-16 01:30:34,519 DEBUG com.example.tmdt.security.jwt.AuthTokenFilter [http-nio-8080-exec-3] Found JWT token in request: eyJhbGciOiJIUzUxMiJ9.eyJzdWIiOiJhMTIzNCIsImlhdCI6MTc0NDY5NDMyNiwiZXhwIjoxNzQ0NzgwNzI2fQ.BdO_Lx19STWajtL_3aPG3UAE47IcXqtg1lV-UsokSSyxYrD8OsPsjBjyrl34GZLD6RHpWE6LJTqDJyQ8OfBUWw
2025-04-16 01:30:34,519 DEBUG com.example.tmdt.security.jwt.JwtUtils [http-nio-8080-exec-3] JWT token validation successful
2025-04-16 01:30:34,519 DEBUG com.example.tmdt.security.jwt.JwtUtils [http-nio-8080-exec-3] Extracted username from JWT token: a1234
2025-04-16 01:30:34,519 DEBUG com.example.tmdt.security.jwt.AuthTokenFilter [http-nio-8080-exec-3] Valid JWT token found for user: a1234
2025-04-16 01:30:34,520 DEBUG org.hibernate.engine.jdbc.spi.SqlStatementLogger [http-nio-8080-exec-3] 
    select
        user0_.id as id1_19_,
        user0_.address as address2_19_,
        user0_.email as email3_19_,
        user0_.full_name as full_nam4_19_,
        user0_.password as password5_19_,
        user0_.phone_number as phone_nu6_19_,
        user0_.username as username7_19_ 
    from
        users user0_ 
    where
        user0_.username=?
2025-04-16 01:30:34,520 TRACE org.hibernate.type.descriptor.sql.BasicBinder [http-nio-8080-exec-3] binding parameter [1] as [VARCHAR] - [a1234]
2025-04-16 01:30:34,521 DEBUG org.hibernate.engine.jdbc.spi.SqlStatementLogger [http-nio-8080-exec-3] 
    select
        userbalanc0_.id as id1_15_0_,
        userbalanc0_.balance as balance2_15_0_,
        userbalanc0_.created_at as created_3_15_0_,
        userbalanc0_.last_deposit_date as last_dep4_15_0_,
        userbalanc0_.last_withdrawal_date as last_wit5_15_0_,
        userbalanc0_.updated_at as updated_6_15_0_,
        userbalanc0_.user_id as user_id7_15_0_ 
    from
        user_balances userbalanc0_ 
    where
        userbalanc0_.user_id=?
2025-04-16 01:30:34,521 TRACE org.hibernate.type.descriptor.sql.BasicBinder [http-nio-8080-exec-3] binding parameter [1] as [BIGINT] - [3]
2025-04-16 01:30:34,522 DEBUG org.hibernate.engine.jdbc.spi.SqlStatementLogger [http-nio-8080-exec-3] 
    select
        roles0_.user_id as user_id1_18_0_,
        roles0_.role_id as role_id2_18_0_,
        role1_.id as id1_14_1_,
        role1_.name as name2_14_1_ 
    from
        user_roles roles0_ 
    inner join
        roles role1_ 
            on roles0_.role_id=role1_.id 
    where
        roles0_.user_id=?
2025-04-16 01:30:34,522 TRACE org.hibernate.type.descriptor.sql.BasicBinder [http-nio-8080-exec-3] binding parameter [1] as [BIGINT] - [3]
2025-04-16 01:30:34,523 DEBUG com.example.tmdt.security.jwt.AuthTokenFilter [http-nio-8080-exec-3] User details loaded for: a1234, User class: com.example.tmdt.security.services.UserDetailsImpl
2025-04-16 01:30:34,524 DEBUG com.example.tmdt.security.jwt.AuthTokenFilter [http-nio-8080-exec-3] User authorities: [ROLE_USER]
2025-04-16 01:30:34,524 DEBUG com.example.tmdt.security.jwt.AuthTokenFilter [http-nio-8080-exec-3] Set authentication for user: a1234 with authorities: [ROLE_USER]
2025-04-16 01:30:34,524 DEBUG com.example.tmdt.security.jwt.AuthTokenFilter [http-nio-8080-exec-3] Authentication set in SecurityContext: UsernamePasswordAuthenticationToken [Principal=com.example.tmdt.security.services.UserDetailsImpl@8abda8f, Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=null], Granted Authorities=[ROLE_USER]], Principal class: com.example.tmdt.security.services.UserDetailsImpl
2025-04-16 01:30:34,524 DEBUG org.springframework.security.web.FilterChainProxy$VirtualFilterChain [http-nio-8080-exec-3] Secured POST /api/chat/messages/system?currentUserId=3
2025-04-16 01:30:34,526 DEBUG com.example.tmdt.utils.LoggerUtil [http-nio-8080-exec-3] ENTERING saveSystemMessage with args: [{content=Connecting you to a support agent. Please wait a moment..., chatSessionId=22d50efd-edeb-47b3-a3bc-59661a84f74e, userId=3}]
2025-04-16 01:30:34,526 INFO com.example.tmdt.controller.ChatController [http-nio-8080-exec-3] Received system message payload: {content=Connecting you to a support agent. Please wait a moment..., chatSessionId=22d50efd-edeb-47b3-a3bc-59661a84f74e, userId=3}
2025-04-16 01:30:34,526 INFO com.example.tmdt.controller.ChatController [http-nio-8080-exec-3] Saving system message. Content: Connecting you to a , SessionId: 22d50efd-edeb-47b3-a3bc-59661a84f74e, UserId: 3
2025-04-16 01:30:34,527 DEBUG org.hibernate.engine.jdbc.spi.SqlStatementLogger [http-nio-8080-exec-3] 
    insert 
    into
        chat_messages
        (chat_session_id, content, created_at, is_read, receiver_id, sender_id, sender_name, sender_type) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-04-16 01:30:34,527 TRACE org.hibernate.type.descriptor.sql.BasicBinder [http-nio-8080-exec-3] binding parameter [1] as [VARCHAR] - [22d50efd-edeb-47b3-a3bc-59661a84f74e]
2025-04-16 01:30:34,527 TRACE org.hibernate.type.descriptor.sql.BasicBinder [http-nio-8080-exec-3] binding parameter [2] as [VARCHAR] - [Connecting you to a support agent. Please wait a moment...]
2025-04-16 01:30:34,528 TRACE org.hibernate.type.descriptor.sql.BasicBinder [http-nio-8080-exec-3] binding parameter [3] as [TIMESTAMP] - [2025-04-16T01:30:34.527850700]
2025-04-16 01:30:34,528 TRACE org.hibernate.type.descriptor.sql.BasicBinder [http-nio-8080-exec-3] binding parameter [4] as [BOOLEAN] - [false]
2025-04-16 01:30:34,528 TRACE org.hibernate.type.descriptor.sql.BasicBinder [http-nio-8080-exec-3] binding parameter [5] as [VARCHAR] - [3]
2025-04-16 01:30:34,528 TRACE org.hibernate.type.descriptor.sql.BasicBinder [http-nio-8080-exec-3] binding parameter [6] as [VARCHAR] - [SYSTEM]
2025-04-16 01:30:34,528 TRACE org.hibernate.type.descriptor.sql.BasicBinder [http-nio-8080-exec-3] binding parameter [7] as [VARCHAR] - [System]
2025-04-16 01:30:34,528 TRACE org.hibernate.type.descriptor.sql.BasicBinder [http-nio-8080-exec-3] binding parameter [8] as [VARCHAR] - [SYSTEM]
2025-04-16 01:30:34,531 DEBUG org.hibernate.engine.jdbc.spi.SqlStatementLogger [http-nio-8080-exec-3] 
    select
        chatsessio0_.id as id1_3_0_,
        chatsessio0_.ended_at as ended_at2_3_0_,
        chatsessio0_.last_message as last_mes3_3_0_,
        chatsessio0_.started_at as started_4_3_0_,
        chatsessio0_.status as status5_3_0_,
        chatsessio0_.unread_count as unread_c6_3_0_,
        chatsessio0_.user_id as user_id7_3_0_,
        chatsessio0_.user_name as user_nam8_3_0_ 
    from
        chat_sessions chatsessio0_ 
    where
        chatsessio0_.id=?
2025-04-16 01:30:34,531 TRACE org.hibernate.type.descriptor.sql.BasicBinder [http-nio-8080-exec-3] binding parameter [1] as [VARCHAR] - [22d50efd-edeb-47b3-a3bc-59661a84f74e]
2025-04-16 01:30:34,534 DEBUG org.hibernate.engine.jdbc.spi.SqlStatementLogger [http-nio-8080-exec-3] 
    update
        chat_sessions 
    set
        ended_at=?,
        last_message=?,
        started_at=?,
        status=?,
        unread_count=?,
        user_id=?,
        user_name=? 
    where
        id=?
2025-04-16 01:30:34,534 TRACE org.hibernate.type.descriptor.sql.BasicBinder [http-nio-8080-exec-3] binding parameter [1] as [TIMESTAMP] - [null]
2025-04-16 01:30:34,535 TRACE org.hibernate.type.descriptor.sql.BasicBinder [http-nio-8080-exec-3] binding parameter [2] as [VARCHAR] - [Connecting you to a support agent. Please wait a moment...]
2025-04-16 01:30:34,535 TRACE org.hibernate.type.descriptor.sql.BasicBinder [http-nio-8080-exec-3] binding parameter [3] as [TIMESTAMP] - [2025-04-16T01:30:34]
2025-04-16 01:30:34,535 TRACE org.hibernate.type.descriptor.sql.BasicBinder [http-nio-8080-exec-3] binding parameter [4] as [VARCHAR] - [ACTIVE]
2025-04-16 01:30:34,535 TRACE org.hibernate.type.descriptor.sql.BasicBinder [http-nio-8080-exec-3] binding parameter [5] as [INTEGER] - [1]
2025-04-16 01:30:34,535 TRACE org.hibernate.type.descriptor.sql.BasicBinder [http-nio-8080-exec-3] binding parameter [6] as [VARCHAR] - [3]
2025-04-16 01:30:34,535 TRACE org.hibernate.type.descriptor.sql.BasicBinder [http-nio-8080-exec-3] binding parameter [7] as [VARCHAR] - [a1234]
2025-04-16 01:30:34,535 TRACE org.hibernate.type.descriptor.sql.BasicBinder [http-nio-8080-exec-3] binding parameter [8] as [VARCHAR] - [22d50efd-edeb-47b3-a3bc-59661a84f74e]
2025-04-16 01:30:34,539 INFO com.example.tmdt.service.ChatService [http-nio-8080-exec-3] Updated lastMessage for session 22d50efd-edeb-47b3-a3bc-59661a84f74e: Connecting you to a support agent. Please wait a moment...
2025-04-16 01:30:34,540 INFO com.example.tmdt.controller.ChatController [http-nio-8080-exec-3] System message saved successfully with id 411
2025-04-16 01:30:34,540 DEBUG com.example.tmdt.utils.LoggerUtil [http-nio-8080-exec-3] EXITING saveSystemMessage with result: [<200 OK OK,ChatMessage(id=411, content=Connecting you to a support agent. Please wait a moment..., senderId=SYSTEM, senderName=System, receiverId=3, senderType=SYSTEM, chatSessionId=22d50efd-edeb-47b3-a3bc-59661a84f74e, createdAt=2025-04-16T01:30:34.527850700, read=false),[]>]
2025-04-16 01:30:34,540 DEBUG com.example.tmdt.utils.LoggerUtil [http-nio-8080-exec-3] Method saveSystemMessage executed in 14 ms
2025-04-16 01:30:34,541 DEBUG org.springframework.security.web.context.SecurityContextPersistenceFilter [http-nio-8080-exec-3] Cleared SecurityContextHolder to complete request
2025-04-16 01:30:34,541 INFO com.example.tmdt.filter.RequestLoggingFilter [http-nio-8080-exec-3] RESPONSE: Status=200, Time=23ms
2025-04-16 01:30:34,562 INFO com.example.tmdt.filter.RequestLoggingFilter [http-nio-8080-exec-4] REQUEST: GET /api/chat/sessions/22d50efd-edeb-47b3-a3bc-59661a84f74e
2025-04-16 01:30:34,562 INFO com.example.tmdt.filter.RequestLoggingFilter [http-nio-8080-exec-4] HEADERS: host=localhost:8080, connection=keep-alive, sec-ch-ua-platform="Windows", authorization=Bearer eyJhbGciOiJIUzUxMiJ9.eyJzdWIiOiJhMTIzNCIsImlhdCI6MTc0NDY5NDMyNiwiZXhwIjoxNzQ0NzgwNzI2fQ.BdO_Lx19STWajtL_3aPG3UAE47IcXqtg1lV-UsokSSyxYrD8OsPsjBjyrl34GZLD6RHpWE6LJTqDJyQ8OfBUWw, user-agent=Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/135.0.0.0 Safari/537.36 Edg/135.0.0.0, accept=application/json, text/plain, */*, sec-ch-ua="Microsoft Edge";v="135", "Not-A.Brand";v="8", "Chromium";v="135", sec-ch-ua-mobile=?0, origin=http://localhost:3000, sec-fetch-site=same-site, sec-fetch-mode=cors, sec-fetch-dest=empty, referer=http://localhost:3000/, accept-encoding=gzip, deflate, br, zstd, accept-language=en-GB,en;q=0.9,en-US;q=0.8
2025-04-16 01:30:34,562 DEBUG org.springframework.security.web.FilterChainProxy [http-nio-8080-exec-4] Securing GET /api/chat/sessions/22d50efd-edeb-47b3-a3bc-59661a84f74e?currentUserId=3
2025-04-16 01:30:34,563 DEBUG org.springframework.security.web.context.SecurityContextPersistenceFilter [http-nio-8080-exec-4] Set SecurityContextHolder to empty SecurityContext
2025-04-16 01:30:34,563 DEBUG com.example.tmdt.security.jwt.AuthTokenFilter [http-nio-8080-exec-4] Processing request to URL: /api/chat/sessions/22d50efd-edeb-47b3-a3bc-59661a84f74e, Method: GET
2025-04-16 01:30:34,563 DEBUG com.example.tmdt.security.jwt.AuthTokenFilter [http-nio-8080-exec-4] Authorization header: Bearer eyJhbGciOiJIUzUxMiJ9.eyJzdWIiOiJhMTIzNCIsImlhdCI6MTc0NDY5NDMyNiwiZXhwIjoxNzQ0NzgwNzI2fQ.BdO_Lx19STWajtL_3aPG3UAE47IcXqtg1lV-UsokSSyxYrD8OsPsjBjyrl34GZLD6RHpWE6LJTqDJyQ8OfBUWw
2025-04-16 01:30:34,563 DEBUG com.example.tmdt.security.jwt.AuthTokenFilter [http-nio-8080-exec-4] Found Authorization header with Bearer token
2025-04-16 01:30:34,563 DEBUG com.example.tmdt.security.jwt.AuthTokenFilter [http-nio-8080-exec-4] Found JWT token in request: eyJhbGciOiJIUzUxMiJ9.eyJzdWIiOiJhMTIzNCIsImlhdCI6MTc0NDY5NDMyNiwiZXhwIjoxNzQ0NzgwNzI2fQ.BdO_Lx19STWajtL_3aPG3UAE47IcXqtg1lV-UsokSSyxYrD8OsPsjBjyrl34GZLD6RHpWE6LJTqDJyQ8OfBUWw
2025-04-16 01:30:34,563 DEBUG com.example.tmdt.security.jwt.JwtUtils [http-nio-8080-exec-4] JWT token validation successful
2025-04-16 01:30:34,563 DEBUG com.example.tmdt.security.jwt.JwtUtils [http-nio-8080-exec-4] Extracted username from JWT token: a1234
2025-04-16 01:30:34,563 DEBUG com.example.tmdt.security.jwt.AuthTokenFilter [http-nio-8080-exec-4] Valid JWT token found for user: a1234
2025-04-16 01:30:34,564 DEBUG org.hibernate.engine.jdbc.spi.SqlStatementLogger [http-nio-8080-exec-4] 
    select
        user0_.id as id1_19_,
        user0_.address as address2_19_,
        user0_.email as email3_19_,
        user0_.full_name as full_nam4_19_,
        user0_.password as password5_19_,
        user0_.phone_number as phone_nu6_19_,
        user0_.username as username7_19_ 
    from
        users user0_ 
    where
        user0_.username=?
2025-04-16 01:30:34,564 TRACE org.hibernate.type.descriptor.sql.BasicBinder [http-nio-8080-exec-4] binding parameter [1] as [VARCHAR] - [a1234]
2025-04-16 01:30:34,565 DEBUG org.hibernate.engine.jdbc.spi.SqlStatementLogger [http-nio-8080-exec-4] 
    select
        userbalanc0_.id as id1_15_0_,
        userbalanc0_.balance as balance2_15_0_,
        userbalanc0_.created_at as created_3_15_0_,
        userbalanc0_.last_deposit_date as last_dep4_15_0_,
        userbalanc0_.last_withdrawal_date as last_wit5_15_0_,
        userbalanc0_.updated_at as updated_6_15_0_,
        userbalanc0_.user_id as user_id7_15_0_ 
    from
        user_balances userbalanc0_ 
    where
        userbalanc0_.user_id=?
2025-04-16 01:30:34,565 TRACE org.hibernate.type.descriptor.sql.BasicBinder [http-nio-8080-exec-4] binding parameter [1] as [BIGINT] - [3]
2025-04-16 01:30:34,566 DEBUG org.hibernate.engine.jdbc.spi.SqlStatementLogger [http-nio-8080-exec-4] 
    select
        roles0_.user_id as user_id1_18_0_,
        roles0_.role_id as role_id2_18_0_,
        role1_.id as id1_14_1_,
        role1_.name as name2_14_1_ 
    from
        user_roles roles0_ 
    inner join
        roles role1_ 
            on roles0_.role_id=role1_.id 
    where
        roles0_.user_id=?
2025-04-16 01:30:34,566 TRACE org.hibernate.type.descriptor.sql.BasicBinder [http-nio-8080-exec-4] binding parameter [1] as [BIGINT] - [3]
2025-04-16 01:30:34,569 DEBUG com.example.tmdt.security.jwt.AuthTokenFilter [http-nio-8080-exec-4] User details loaded for: a1234, User class: com.example.tmdt.security.services.UserDetailsImpl
2025-04-16 01:30:34,569 DEBUG com.example.tmdt.security.jwt.AuthTokenFilter [http-nio-8080-exec-4] User authorities: [ROLE_USER]
2025-04-16 01:30:34,569 DEBUG com.example.tmdt.security.jwt.AuthTokenFilter [http-nio-8080-exec-4] Set authentication for user: a1234 with authorities: [ROLE_USER]
2025-04-16 01:30:34,569 DEBUG com.example.tmdt.security.jwt.AuthTokenFilter [http-nio-8080-exec-4] Authentication set in SecurityContext: UsernamePasswordAuthenticationToken [Principal=com.example.tmdt.security.services.UserDetailsImpl@7f547108, Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=null], Granted Authorities=[ROLE_USER]], Principal class: com.example.tmdt.security.services.UserDetailsImpl
2025-04-16 01:30:34,569 DEBUG org.springframework.security.web.FilterChainProxy$VirtualFilterChain [http-nio-8080-exec-4] Secured GET /api/chat/sessions/22d50efd-edeb-47b3-a3bc-59661a84f74e?currentUserId=3
2025-04-16 01:30:34,569 DEBUG com.example.tmdt.utils.LoggerUtil [http-nio-8080-exec-4] ENTERING getChatSessionById with args: [22d50efd-edeb-47b3-a3bc-59661a84f74e]
2025-04-16 01:30:34,570 DEBUG org.hibernate.engine.jdbc.spi.SqlStatementLogger [http-nio-8080-exec-4] 
    select
        chatsessio0_.id as id1_3_0_,
        chatsessio0_.ended_at as ended_at2_3_0_,
        chatsessio0_.last_message as last_mes3_3_0_,
        chatsessio0_.started_at as started_4_3_0_,
        chatsessio0_.status as status5_3_0_,
        chatsessio0_.unread_count as unread_c6_3_0_,
        chatsessio0_.user_id as user_id7_3_0_,
        chatsessio0_.user_name as user_nam8_3_0_ 
    from
        chat_sessions chatsessio0_ 
    where
        chatsessio0_.id=?
2025-04-16 01:30:34,570 TRACE org.hibernate.type.descriptor.sql.BasicBinder [http-nio-8080-exec-4] binding parameter [1] as [VARCHAR] - [22d50efd-edeb-47b3-a3bc-59661a84f74e]
2025-04-16 01:30:34,572 DEBUG com.example.tmdt.utils.LoggerUtil [http-nio-8080-exec-4] EXITING getChatSessionById with result: [<200 OK OK,ChatSession(id=22d50efd-edeb-47b3-a3bc-59661a84f74e, userId=3, userName=a1234, startedAt=2025-04-16T01:30:34, endedAt=null, status=ACTIVE, lastMessage=Connecting you to a support agent. Please wait a moment..., unreadCount=1),[]>]
2025-04-16 01:30:34,572 DEBUG com.example.tmdt.utils.LoggerUtil [http-nio-8080-exec-4] Method getChatSessionById executed in 3 ms
2025-04-16 01:30:34,572 DEBUG org.springframework.security.web.context.SecurityContextPersistenceFilter [http-nio-8080-exec-4] Cleared SecurityContextHolder to complete request
2025-04-16 01:30:34,572 INFO com.example.tmdt.filter.RequestLoggingFilter [http-nio-8080-exec-4] RESPONSE: Status=200, Time=10ms
2025-04-16 01:30:34,575 INFO com.example.tmdt.filter.RequestLoggingFilter [http-nio-8089-exec-32] REQUEST: GET /chat
2025-04-16 01:30:34,575 INFO com.example.tmdt.filter.RequestLoggingFilter [http-nio-8089-exec-32] HEADERS: host=localhost:8089, connection=Upgrade, pragma=no-cache, cache-control=no-cache, user-agent=Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/135.0.0.0 Safari/537.36 Edg/135.0.0.0, upgrade=websocket, origin=http://localhost:3000, sec-websocket-version=13, accept-encoding=gzip, deflate, br, zstd, accept-language=en-GB,en;q=0.9,en-US;q=0.8, sec-websocket-key=w7HjdakU1e4cOVWGcz3RNQ==, sec-websocket-extensions=permessage-deflate; client_max_window_bits
2025-04-16 01:30:34,575 DEBUG org.springframework.security.web.FilterChainProxy [http-nio-8089-exec-32] Securing GET /chat
2025-04-16 01:30:34,575 DEBUG org.springframework.security.web.context.SecurityContextPersistenceFilter [http-nio-8089-exec-32] Set SecurityContextHolder to empty SecurityContext
2025-04-16 01:30:34,576 DEBUG com.example.tmdt.security.jwt.AuthTokenFilter [http-nio-8089-exec-32] Processing request to URL: /chat, Method: GET
2025-04-16 01:30:34,576 DEBUG com.example.tmdt.security.jwt.AuthTokenFilter [http-nio-8089-exec-32] Authorization header: null
2025-04-16 01:30:34,576 DEBUG com.example.tmdt.security.jwt.AuthTokenFilter [http-nio-8089-exec-32] No Authorization header found in request
2025-04-16 01:30:34,576 DEBUG com.example.tmdt.security.jwt.AuthTokenFilter [http-nio-8089-exec-32] No JWT token found in request to: /chat
2025-04-16 01:30:34,576 DEBUG org.springframework.security.web.authentication.AnonymousAuthenticationFilter [http-nio-8089-exec-32] Set SecurityContextHolder to anonymous SecurityContext
2025-04-16 01:30:34,576 DEBUG org.springframework.security.web.FilterChainProxy$VirtualFilterChain [http-nio-8089-exec-32] Secured GET /chat
2025-04-16 01:30:34,577 DEBUG org.springframework.security.web.context.SecurityContextPersistenceFilter [http-nio-8089-exec-32] Cleared SecurityContextHolder to complete request
2025-04-16 01:30:34,577 INFO com.example.tmdt.filter.RequestLoggingFilter [http-nio-8089-exec-32] RESPONSE: Status=101, Time=2ms
2025-04-16 01:30:34,578 INFO com.example.tmdt.websocket.ChatWebSocketHandler [http-nio-8089-exec-32] WebSocket connection established: 83bb8b9a-fb2f-d437-2916-9a1744c4bdaf
2025-04-16 01:30:34,578 INFO com.example.tmdt.websocket.ChatWebSocketHandler [http-nio-8089-exec-32] Remote address: /[0:0:0:0:0:0:0:1]:51184
2025-04-16 01:30:34,578 INFO com.example.tmdt.websocket.ChatWebSocketHandler [http-nio-8089-exec-32] URI: ws://localhost:8089/chat
2025-04-16 01:30:34,587 INFO com.example.tmdt.websocket.ChatWebSocketHandler [http-nio-8089-exec-27] Received message: {"type":"USER_CONNECT","userId":"3","username":"a1234","isAnonymous":false,"sessionId":"22d50efd-edeb-47b3-a3bc-59661a84f74e","timestamp":1744741834587,"senderType":"USER","sender":"user"}
2025-04-16 01:30:34,587 INFO com.example.tmdt.websocket.ChatWebSocketHandler [http-nio-8089-exec-27] User connected: a1234 (3) isAnonymous: false
2025-04-16 01:30:34,587 INFO com.example.tmdt.websocket.ChatWebSocketHandler [http-nio-8089-exec-27] Storing mappings for user 3 with session ID 22d50efd-edeb-47b3-a3bc-59661a84f74e
2025-04-16 01:30:34,588 DEBUG org.hibernate.engine.jdbc.spi.SqlStatementLogger [http-nio-8089-exec-27] 
    select
        chatmessag0_.id as id1_2_,
        chatmessag0_.chat_session_id as chat_ses2_2_,
        chatmessag0_.content as content3_2_,
        chatmessag0_.created_at as created_4_2_,
        chatmessag0_.is_read as is_read5_2_,
        chatmessag0_.receiver_id as receiver6_2_,
        chatmessag0_.sender_id as sender_i7_2_,
        chatmessag0_.sender_name as sender_n8_2_,
        chatmessag0_.sender_type as sender_t9_2_ 
    from
        chat_messages chatmessag0_ 
    where
        chatmessag0_.chat_session_id=? 
    order by
        chatmessag0_.created_at asc
2025-04-16 01:30:34,588 TRACE org.hibernate.type.descriptor.sql.BasicBinder [http-nio-8089-exec-27] binding parameter [1] as [VARCHAR] - [22d50efd-edeb-47b3-a3bc-59661a84f74e]
2025-04-16 01:30:34,589 INFO com.example.tmdt.websocket.ChatWebSocketHandler [http-nio-8089-exec-27] Sending 2 previous messages to user 3
2025-04-16 01:30:34,589 INFO com.example.tmdt.websocket.ChatWebSocketHandler [http-nio-8089-exec-27] Notifying admins about new user: a1234 (3)
2025-04-16 01:30:34,590 INFO com.example.tmdt.websocket.ChatWebSocketHandler [http-nio-8089-exec-27] Number of admin sessions: 1
2025-04-16 01:30:34,590 INFO com.example.tmdt.websocket.ChatWebSocketHandler [http-nio-8089-exec-27] Sending notification to admin: 2
2025-04-16 01:30:34,592 INFO com.example.tmdt.filter.RequestLoggingFilter [http-nio-8080-exec-10] REQUEST: GET /api/chat/sessions/active
2025-04-16 01:30:34,592 INFO com.example.tmdt.filter.RequestLoggingFilter [http-nio-8080-exec-10] HEADERS: host=localhost:8080, connection=keep-alive, sec-ch-ua-platform="Windows", authorization=Bearer eyJhbGciOiJIUzUxMiJ9.eyJzdWIiOiJhZG1pbiIsImlhdCI6MTc0NDczMTMzOSwiZXhwIjoxNzQ0ODE3NzM5fQ.v-t4oABHhkaDi26bHf9oNlBgDITHxwLTyyO6o-6cY9ctKD3wySIuuJ8Ug1erRaTivtrcXJmKE20M5XdQn9Kciw, user-agent=Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/135.0.0.0 Safari/537.36 Edg/135.0.0.0, accept=application/json, text/plain, */*, sec-ch-ua="Microsoft Edge";v="135", "Not-A.Brand";v="8", "Chromium";v="135", sec-ch-ua-mobile=?0, origin=http://localhost:3001, sec-fetch-site=same-site, sec-fetch-mode=cors, sec-fetch-dest=empty, referer=http://localhost:3001/, accept-encoding=gzip, deflate, br, zstd, accept-language=en-GB,en;q=0.9,en-US;q=0.8
2025-04-16 01:30:34,592 DEBUG org.springframework.security.web.FilterChainProxy [http-nio-8080-exec-10] Securing GET /api/chat/sessions/active?currentUserId=2
2025-04-16 01:30:34,592 DEBUG org.springframework.security.web.context.SecurityContextPersistenceFilter [http-nio-8080-exec-10] Set SecurityContextHolder to empty SecurityContext
2025-04-16 01:30:34,592 DEBUG com.example.tmdt.security.jwt.AuthTokenFilter [http-nio-8080-exec-10] Processing request to URL: /api/chat/sessions/active, Method: GET
2025-04-16 01:30:34,593 DEBUG com.example.tmdt.security.jwt.AuthTokenFilter [http-nio-8080-exec-10] Authorization header: Bearer eyJhbGciOiJIUzUxMiJ9.eyJzdWIiOiJhZG1pbiIsImlhdCI6MTc0NDczMTMzOSwiZXhwIjoxNzQ0ODE3NzM5fQ.v-t4oABHhkaDi26bHf9oNlBgDITHxwLTyyO6o-6cY9ctKD3wySIuuJ8Ug1erRaTivtrcXJmKE20M5XdQn9Kciw
2025-04-16 01:30:34,593 DEBUG com.example.tmdt.security.jwt.AuthTokenFilter [http-nio-8080-exec-10] Found Authorization header with Bearer token
2025-04-16 01:30:34,593 DEBUG com.example.tmdt.security.jwt.AuthTokenFilter [http-nio-8080-exec-10] Found JWT token in request: eyJhbGciOiJIUzUxMiJ9.eyJzdWIiOiJhZG1pbiIsImlhdCI6MTc0NDczMTMzOSwiZXhwIjoxNzQ0ODE3NzM5fQ.v-t4oABHhkaDi26bHf9oNlBgDITHxwLTyyO6o-6cY9ctKD3wySIuuJ8Ug1erRaTivtrcXJmKE20M5XdQn9Kciw
2025-04-16 01:30:34,593 DEBUG com.example.tmdt.security.jwt.JwtUtils [http-nio-8080-exec-10] JWT token validation successful
2025-04-16 01:30:34,593 DEBUG com.example.tmdt.security.jwt.JwtUtils [http-nio-8080-exec-10] Extracted username from JWT token: admin
2025-04-16 01:30:34,593 DEBUG com.example.tmdt.security.jwt.AuthTokenFilter [http-nio-8080-exec-10] Valid JWT token found for user: admin
2025-04-16 01:30:34,594 DEBUG org.hibernate.engine.jdbc.spi.SqlStatementLogger [http-nio-8080-exec-10] 
    select
        user0_.id as id1_19_,
        user0_.address as address2_19_,
        user0_.email as email3_19_,
        user0_.full_name as full_nam4_19_,
        user0_.password as password5_19_,
        user0_.phone_number as phone_nu6_19_,
        user0_.username as username7_19_ 
    from
        users user0_ 
    where
        user0_.username=?
2025-04-16 01:30:34,594 TRACE org.hibernate.type.descriptor.sql.BasicBinder [http-nio-8080-exec-10] binding parameter [1] as [VARCHAR] - [admin]
2025-04-16 01:30:34,595 DEBUG org.hibernate.engine.jdbc.spi.SqlStatementLogger [http-nio-8080-exec-10] 
    select
        userbalanc0_.id as id1_15_0_,
        userbalanc0_.balance as balance2_15_0_,
        userbalanc0_.created_at as created_3_15_0_,
        userbalanc0_.last_deposit_date as last_dep4_15_0_,
        userbalanc0_.last_withdrawal_date as last_wit5_15_0_,
        userbalanc0_.updated_at as updated_6_15_0_,
        userbalanc0_.user_id as user_id7_15_0_ 
    from
        user_balances userbalanc0_ 
    where
        userbalanc0_.user_id=?
2025-04-16 01:30:34,596 TRACE org.hibernate.type.descriptor.sql.BasicBinder [http-nio-8080-exec-10] binding parameter [1] as [BIGINT] - [2]
2025-04-16 01:30:34,596 DEBUG org.hibernate.engine.jdbc.spi.SqlStatementLogger [http-nio-8080-exec-10] 
    select
        roles0_.user_id as user_id1_18_0_,
        roles0_.role_id as role_id2_18_0_,
        role1_.id as id1_14_1_,
        role1_.name as name2_14_1_ 
    from
        user_roles roles0_ 
    inner join
        roles role1_ 
            on roles0_.role_id=role1_.id 
    where
        roles0_.user_id=?
2025-04-16 01:30:34,596 TRACE org.hibernate.type.descriptor.sql.BasicBinder [http-nio-8080-exec-10] binding parameter [1] as [BIGINT] - [2]
2025-04-16 01:30:34,598 DEBUG com.example.tmdt.security.jwt.AuthTokenFilter [http-nio-8080-exec-10] User details loaded for: admin, User class: com.example.tmdt.security.services.UserDetailsImpl
2025-04-16 01:30:34,598 DEBUG com.example.tmdt.security.jwt.AuthTokenFilter [http-nio-8080-exec-10] User authorities: [ROLE_ADMIN]
2025-04-16 01:30:34,598 DEBUG com.example.tmdt.security.jwt.AuthTokenFilter [http-nio-8080-exec-10] Set authentication for user: admin with authorities: [ROLE_ADMIN]
2025-04-16 01:30:34,598 DEBUG com.example.tmdt.security.jwt.AuthTokenFilter [http-nio-8080-exec-10] Authentication set in SecurityContext: UsernamePasswordAuthenticationToken [Principal=com.example.tmdt.security.services.UserDetailsImpl@7a433cd1, Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=null], Granted Authorities=[ROLE_ADMIN]], Principal class: com.example.tmdt.security.services.UserDetailsImpl
2025-04-16 01:30:34,598 DEBUG org.springframework.security.web.FilterChainProxy$VirtualFilterChain [http-nio-8080-exec-10] Secured GET /api/chat/sessions/active?currentUserId=2
2025-04-16 01:30:34,599 DEBUG org.springframework.security.authorization.method.AuthorizationManagerBeforeMethodInterceptor [http-nio-8080-exec-10] Authorizing method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity com.example.tmdt.controller.ChatController.getActiveChatSessions(); target is of class [com.example.tmdt.controller.ChatController]
2025-04-16 01:30:34,599 DEBUG org.springframework.security.authorization.method.AuthorizationManagerBeforeMethodInterceptor [http-nio-8080-exec-10] Authorized method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity com.example.tmdt.controller.ChatController.getActiveChatSessions(); target is of class [com.example.tmdt.controller.ChatController]
2025-04-16 01:30:34,599 DEBUG com.example.tmdt.utils.LoggerUtil [http-nio-8080-exec-10] ENTERING getActiveChatSessions
2025-04-16 01:30:34,599 INFO com.example.tmdt.controller.ChatController [http-nio-8080-exec-10] Getting active chat sessions
2025-04-16 01:30:34,599 INFO com.example.tmdt.service.ChatService [http-nio-8080-exec-10] Getting active chat sessions from repository
2025-04-16 01:30:34,599 DEBUG org.hibernate.engine.jdbc.spi.SqlStatementLogger [http-nio-8080-exec-10] 
    select
        chatsessio0_.id as id1_3_,
        chatsessio0_.ended_at as ended_at2_3_,
        chatsessio0_.last_message as last_mes3_3_,
        chatsessio0_.started_at as started_4_3_,
        chatsessio0_.status as status5_3_,
        chatsessio0_.unread_count as unread_c6_3_,
        chatsessio0_.user_id as user_id7_3_,
        chatsessio0_.user_name as user_nam8_3_ 
    from
        chat_sessions chatsessio0_ 
    where
        chatsessio0_.status=? 
    order by
        chatsessio0_.started_at desc
2025-04-16 01:30:34,600 TRACE org.hibernate.type.descriptor.sql.BasicBinder [http-nio-8080-exec-10] binding parameter [1] as [VARCHAR] - [ACTIVE]
2025-04-16 01:30:34,601 INFO com.example.tmdt.controller.ChatController [http-nio-8080-exec-10] Found 1 active sessions
2025-04-16 01:30:34,601 DEBUG com.example.tmdt.utils.LoggerUtil [http-nio-8080-exec-10] EXITING getActiveChatSessions with result: [<200 OK OK,[ChatSession(id=22d50efd-edeb-47b3-a3bc-59661a84f74e, userId=3, userName=a1234, startedAt=2025-04-16T01:30:34, endedAt=null, status=ACTIVE, lastMessage=Connecting you to a support agent. Please wait a moment..., unreadCount=1)],[]>]
2025-04-16 01:30:34,602 DEBUG com.example.tmdt.utils.LoggerUtil [http-nio-8080-exec-10] Method getActiveChatSessions executed in 3 ms
2025-04-16 01:30:34,603 DEBUG org.springframework.security.web.context.SecurityContextPersistenceFilter [http-nio-8080-exec-10] Cleared SecurityContextHolder to complete request
2025-04-16 01:30:34,603 INFO com.example.tmdt.filter.RequestLoggingFilter [http-nio-8080-exec-10] RESPONSE: Status=200, Time=11ms
2025-04-16 01:30:36,324 INFO com.example.tmdt.filter.RequestLoggingFilter [http-nio-8080-exec-7] REQUEST: OPTIONS /api/chat/messages/session/22d50efd-edeb-47b3-a3bc-59661a84f74e
2025-04-16 01:30:36,325 INFO com.example.tmdt.filter.RequestLoggingFilter [http-nio-8080-exec-7] HEADERS: host=localhost:8080, connection=keep-alive, accept=*/*, access-control-request-method=GET, access-control-request-headers=authorization, origin=http://localhost:3001, user-agent=Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/135.0.0.0 Safari/537.36 Edg/135.0.0.0, sec-fetch-mode=cors, sec-fetch-site=same-site, sec-fetch-dest=empty, referer=http://localhost:3001/, accept-encoding=gzip, deflate, br, zstd, accept-language=en-GB,en;q=0.9,en-US;q=0.8
2025-04-16 01:30:36,325 INFO com.example.tmdt.filter.RequestLoggingFilter [http-nio-8080-exec-7] RESPONSE: Status=200 (OK - CORS Preflight)
2025-04-16 01:30:36,326 INFO com.example.tmdt.filter.RequestLoggingFilter [http-nio-8080-exec-1] REQUEST: GET /api/chat/messages/session/22d50efd-edeb-47b3-a3bc-59661a84f74e
2025-04-16 01:30:36,326 INFO com.example.tmdt.filter.RequestLoggingFilter [http-nio-8080-exec-1] HEADERS: host=localhost:8080, connection=keep-alive, sec-ch-ua-platform="Windows", authorization=Bearer eyJhbGciOiJIUzUxMiJ9.eyJzdWIiOiJhZG1pbiIsImlhdCI6MTc0NDczMTMzOSwiZXhwIjoxNzQ0ODE3NzM5fQ.v-t4oABHhkaDi26bHf9oNlBgDITHxwLTyyO6o-6cY9ctKD3wySIuuJ8Ug1erRaTivtrcXJmKE20M5XdQn9Kciw, user-agent=Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/135.0.0.0 Safari/537.36 Edg/135.0.0.0, accept=application/json, text/plain, */*, sec-ch-ua="Microsoft Edge";v="135", "Not-A.Brand";v="8", "Chromium";v="135", sec-ch-ua-mobile=?0, origin=http://localhost:3001, sec-fetch-site=same-site, sec-fetch-mode=cors, sec-fetch-dest=empty, referer=http://localhost:3001/, accept-encoding=gzip, deflate, br, zstd, accept-language=en-GB,en;q=0.9,en-US;q=0.8
2025-04-16 01:30:36,327 DEBUG org.springframework.security.web.FilterChainProxy [http-nio-8080-exec-1] Securing GET /api/chat/messages/session/22d50efd-edeb-47b3-a3bc-59661a84f74e?currentUserId=2
2025-04-16 01:30:36,327 DEBUG org.springframework.security.web.context.SecurityContextPersistenceFilter [http-nio-8080-exec-1] Set SecurityContextHolder to empty SecurityContext
2025-04-16 01:30:36,327 DEBUG com.example.tmdt.security.jwt.AuthTokenFilter [http-nio-8080-exec-1] Processing request to URL: /api/chat/messages/session/22d50efd-edeb-47b3-a3bc-59661a84f74e, Method: GET
2025-04-16 01:30:36,327 DEBUG com.example.tmdt.security.jwt.AuthTokenFilter [http-nio-8080-exec-1] Authorization header: Bearer eyJhbGciOiJIUzUxMiJ9.eyJzdWIiOiJhZG1pbiIsImlhdCI6MTc0NDczMTMzOSwiZXhwIjoxNzQ0ODE3NzM5fQ.v-t4oABHhkaDi26bHf9oNlBgDITHxwLTyyO6o-6cY9ctKD3wySIuuJ8Ug1erRaTivtrcXJmKE20M5XdQn9Kciw
2025-04-16 01:30:36,327 DEBUG com.example.tmdt.security.jwt.AuthTokenFilter [http-nio-8080-exec-1] Found Authorization header with Bearer token
2025-04-16 01:30:36,327 DEBUG com.example.tmdt.security.jwt.AuthTokenFilter [http-nio-8080-exec-1] Found JWT token in request: eyJhbGciOiJIUzUxMiJ9.eyJzdWIiOiJhZG1pbiIsImlhdCI6MTc0NDczMTMzOSwiZXhwIjoxNzQ0ODE3NzM5fQ.v-t4oABHhkaDi26bHf9oNlBgDITHxwLTyyO6o-6cY9ctKD3wySIuuJ8Ug1erRaTivtrcXJmKE20M5XdQn9Kciw
2025-04-16 01:30:36,327 DEBUG com.example.tmdt.security.jwt.JwtUtils [http-nio-8080-exec-1] JWT token validation successful
2025-04-16 01:30:36,327 DEBUG com.example.tmdt.security.jwt.JwtUtils [http-nio-8080-exec-1] Extracted username from JWT token: admin
2025-04-16 01:30:36,327 DEBUG com.example.tmdt.security.jwt.AuthTokenFilter [http-nio-8080-exec-1] Valid JWT token found for user: admin
2025-04-16 01:30:36,328 DEBUG org.hibernate.engine.jdbc.spi.SqlStatementLogger [http-nio-8080-exec-1] 
    select
        user0_.id as id1_19_,
        user0_.address as address2_19_,
        user0_.email as email3_19_,
        user0_.full_name as full_nam4_19_,
        user0_.password as password5_19_,
        user0_.phone_number as phone_nu6_19_,
        user0_.username as username7_19_ 
    from
        users user0_ 
    where
        user0_.username=?
2025-04-16 01:30:36,329 TRACE org.hibernate.type.descriptor.sql.BasicBinder [http-nio-8080-exec-1] binding parameter [1] as [VARCHAR] - [admin]
2025-04-16 01:30:36,330 DEBUG org.hibernate.engine.jdbc.spi.SqlStatementLogger [http-nio-8080-exec-1] 
    select
        userbalanc0_.id as id1_15_0_,
        userbalanc0_.balance as balance2_15_0_,
        userbalanc0_.created_at as created_3_15_0_,
        userbalanc0_.last_deposit_date as last_dep4_15_0_,
        userbalanc0_.last_withdrawal_date as last_wit5_15_0_,
        userbalanc0_.updated_at as updated_6_15_0_,
        userbalanc0_.user_id as user_id7_15_0_ 
    from
        user_balances userbalanc0_ 
    where
        userbalanc0_.user_id=?
2025-04-16 01:30:36,331 TRACE org.hibernate.type.descriptor.sql.BasicBinder [http-nio-8080-exec-1] binding parameter [1] as [BIGINT] - [2]
2025-04-16 01:30:36,331 DEBUG org.hibernate.engine.jdbc.spi.SqlStatementLogger [http-nio-8080-exec-1] 
    select
        roles0_.user_id as user_id1_18_0_,
        roles0_.role_id as role_id2_18_0_,
        role1_.id as id1_14_1_,
        role1_.name as name2_14_1_ 
    from
        user_roles roles0_ 
    inner join
        roles role1_ 
            on roles0_.role_id=role1_.id 
    where
        roles0_.user_id=?
2025-04-16 01:30:36,332 TRACE org.hibernate.type.descriptor.sql.BasicBinder [http-nio-8080-exec-1] binding parameter [1] as [BIGINT] - [2]
2025-04-16 01:30:36,333 DEBUG com.example.tmdt.security.jwt.AuthTokenFilter [http-nio-8080-exec-1] User details loaded for: admin, User class: com.example.tmdt.security.services.UserDetailsImpl
2025-04-16 01:30:36,334 DEBUG com.example.tmdt.security.jwt.AuthTokenFilter [http-nio-8080-exec-1] User authorities: [ROLE_ADMIN]
2025-04-16 01:30:36,334 DEBUG com.example.tmdt.security.jwt.AuthTokenFilter [http-nio-8080-exec-1] Set authentication for user: admin with authorities: [ROLE_ADMIN]
2025-04-16 01:30:36,334 DEBUG com.example.tmdt.security.jwt.AuthTokenFilter [http-nio-8080-exec-1] Authentication set in SecurityContext: UsernamePasswordAuthenticationToken [Principal=com.example.tmdt.security.services.UserDetailsImpl@8ae1584, Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=null], Granted Authorities=[ROLE_ADMIN]], Principal class: com.example.tmdt.security.services.UserDetailsImpl
2025-04-16 01:30:36,334 DEBUG org.springframework.security.web.FilterChainProxy$VirtualFilterChain [http-nio-8080-exec-1] Secured GET /api/chat/messages/session/22d50efd-edeb-47b3-a3bc-59661a84f74e?currentUserId=2
2025-04-16 01:30:36,334 DEBUG com.example.tmdt.utils.LoggerUtil [http-nio-8080-exec-1] ENTERING getMessagesByChatSession with args: [22d50efd-edeb-47b3-a3bc-59661a84f74e]
2025-04-16 01:30:36,335 INFO com.example.tmdt.controller.ChatController [http-nio-8080-exec-1] Getting messages for session 22d50efd-edeb-47b3-a3bc-59661a84f74e
2025-04-16 01:30:36,335 DEBUG org.hibernate.engine.jdbc.spi.SqlStatementLogger [http-nio-8080-exec-1] 
    select
        chatmessag0_.id as id1_2_,
        chatmessag0_.chat_session_id as chat_ses2_2_,
        chatmessag0_.content as content3_2_,
        chatmessag0_.created_at as created_4_2_,
        chatmessag0_.is_read as is_read5_2_,
        chatmessag0_.receiver_id as receiver6_2_,
        chatmessag0_.sender_id as sender_i7_2_,
        chatmessag0_.sender_name as sender_n8_2_,
        chatmessag0_.sender_type as sender_t9_2_ 
    from
        chat_messages chatmessag0_ 
    where
        chatmessag0_.chat_session_id=? 
    order by
        chatmessag0_.created_at asc
2025-04-16 01:30:36,335 TRACE org.hibernate.type.descriptor.sql.BasicBinder [http-nio-8080-exec-1] binding parameter [1] as [VARCHAR] - [22d50efd-edeb-47b3-a3bc-59661a84f74e]
2025-04-16 01:30:36,337 INFO com.example.tmdt.controller.ChatController [http-nio-8080-exec-1] Found 2 messages for session 22d50efd-edeb-47b3-a3bc-59661a84f74e
2025-04-16 01:30:36,338 DEBUG com.example.tmdt.utils.LoggerUtil [http-nio-8080-exec-1] EXITING getMessagesByChatSession with result: [<200 OK OK,[ChatMessage(id=410, content=s, senderId=3, senderName=a1234, receiverId=null, senderType=USER, chatSessionId=22d50efd-edeb-47b3-a3bc-59661a84f74e, createdAt=2025-04-16T01:30:34, read=false), ChatMessage(id=411, content=Connecting you to a support agent. Please wait a moment..., senderId=SYSTEM, senderName=System, receiverId=3, senderType=SYSTEM, chatSessionId=22d50efd-edeb-47b3-a3bc-59661a84f74e, createdAt=2025-04-16T01:30:34, read=false)],[]>]
2025-04-16 01:30:36,338 DEBUG com.example.tmdt.utils.LoggerUtil [http-nio-8080-exec-1] Method getMessagesByChatSession executed in 4 ms
2025-04-16 01:30:36,339 DEBUG org.springframework.security.web.context.SecurityContextPersistenceFilter [http-nio-8080-exec-1] Cleared SecurityContextHolder to complete request
2025-04-16 01:30:36,339 INFO com.example.tmdt.filter.RequestLoggingFilter [http-nio-8080-exec-1] RESPONSE: Status=200, Time=13ms
2025-04-16 01:30:36,341 INFO com.example.tmdt.filter.RequestLoggingFilter [http-nio-8080-exec-6] REQUEST: OPTIONS /api/chat/sessions/22d50efd-edeb-47b3-a3bc-59661a84f74e/read
2025-04-16 01:30:36,341 INFO com.example.tmdt.filter.RequestLoggingFilter [http-nio-8080-exec-6] HEADERS: host=localhost:8080, connection=keep-alive, accept=*/*, access-control-request-method=PUT, access-control-request-headers=authorization, origin=http://localhost:3001, user-agent=Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/135.0.0.0 Safari/537.36 Edg/135.0.0.0, sec-fetch-mode=cors, sec-fetch-site=same-site, sec-fetch-dest=empty, referer=http://localhost:3001/, accept-encoding=gzip, deflate, br, zstd, accept-language=en-GB,en;q=0.9,en-US;q=0.8
2025-04-16 01:30:36,341 INFO com.example.tmdt.filter.RequestLoggingFilter [http-nio-8080-exec-6] RESPONSE: Status=200 (OK - CORS Preflight)
2025-04-16 01:30:36,342 INFO com.example.tmdt.filter.RequestLoggingFilter [http-nio-8080-exec-8] REQUEST: PUT /api/chat/sessions/22d50efd-edeb-47b3-a3bc-59661a84f74e/read
2025-04-16 01:30:36,342 INFO com.example.tmdt.filter.RequestLoggingFilter [http-nio-8080-exec-8] HEADERS: host=localhost:8080, connection=keep-alive, content-length=0, sec-ch-ua-platform="Windows", authorization=Bearer eyJhbGciOiJIUzUxMiJ9.eyJzdWIiOiJhZG1pbiIsImlhdCI6MTc0NDczMTMzOSwiZXhwIjoxNzQ0ODE3NzM5fQ.v-t4oABHhkaDi26bHf9oNlBgDITHxwLTyyO6o-6cY9ctKD3wySIuuJ8Ug1erRaTivtrcXJmKE20M5XdQn9Kciw, user-agent=Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/135.0.0.0 Safari/537.36 Edg/135.0.0.0, accept=application/json, text/plain, */*, sec-ch-ua="Microsoft Edge";v="135", "Not-A.Brand";v="8", "Chromium";v="135", sec-ch-ua-mobile=?0, origin=http://localhost:3001, sec-fetch-site=same-site, sec-fetch-mode=cors, sec-fetch-dest=empty, referer=http://localhost:3001/, accept-encoding=gzip, deflate, br, zstd, accept-language=en-GB,en;q=0.9,en-US;q=0.8
2025-04-16 01:30:36,342 DEBUG org.springframework.security.web.FilterChainProxy [http-nio-8080-exec-8] Securing PUT /api/chat/sessions/22d50efd-edeb-47b3-a3bc-59661a84f74e/read?currentUserId=2
2025-04-16 01:30:36,343 DEBUG org.springframework.security.web.context.SecurityContextPersistenceFilter [http-nio-8080-exec-8] Set SecurityContextHolder to empty SecurityContext
2025-04-16 01:30:36,343 DEBUG com.example.tmdt.security.jwt.AuthTokenFilter [http-nio-8080-exec-8] Processing request to URL: /api/chat/sessions/22d50efd-edeb-47b3-a3bc-59661a84f74e/read, Method: PUT
2025-04-16 01:30:36,343 DEBUG com.example.tmdt.security.jwt.AuthTokenFilter [http-nio-8080-exec-8] Authorization header: Bearer eyJhbGciOiJIUzUxMiJ9.eyJzdWIiOiJhZG1pbiIsImlhdCI6MTc0NDczMTMzOSwiZXhwIjoxNzQ0ODE3NzM5fQ.v-t4oABHhkaDi26bHf9oNlBgDITHxwLTyyO6o-6cY9ctKD3wySIuuJ8Ug1erRaTivtrcXJmKE20M5XdQn9Kciw
2025-04-16 01:30:36,343 DEBUG com.example.tmdt.security.jwt.AuthTokenFilter [http-nio-8080-exec-8] Found Authorization header with Bearer token
2025-04-16 01:30:36,343 DEBUG com.example.tmdt.security.jwt.AuthTokenFilter [http-nio-8080-exec-8] Found JWT token in request: eyJhbGciOiJIUzUxMiJ9.eyJzdWIiOiJhZG1pbiIsImlhdCI6MTc0NDczMTMzOSwiZXhwIjoxNzQ0ODE3NzM5fQ.v-t4oABHhkaDi26bHf9oNlBgDITHxwLTyyO6o-6cY9ctKD3wySIuuJ8Ug1erRaTivtrcXJmKE20M5XdQn9Kciw
2025-04-16 01:30:36,343 DEBUG com.example.tmdt.security.jwt.JwtUtils [http-nio-8080-exec-8] JWT token validation successful
2025-04-16 01:30:36,344 DEBUG com.example.tmdt.security.jwt.JwtUtils [http-nio-8080-exec-8] Extracted username from JWT token: admin
2025-04-16 01:30:36,344 DEBUG com.example.tmdt.security.jwt.AuthTokenFilter [http-nio-8080-exec-8] Valid JWT token found for user: admin
2025-04-16 01:30:36,345 DEBUG org.hibernate.engine.jdbc.spi.SqlStatementLogger [http-nio-8080-exec-8] 
    select
        user0_.id as id1_19_,
        user0_.address as address2_19_,
        user0_.email as email3_19_,
        user0_.full_name as full_nam4_19_,
        user0_.password as password5_19_,
        user0_.phone_number as phone_nu6_19_,
        user0_.username as username7_19_ 
    from
        users user0_ 
    where
        user0_.username=?
2025-04-16 01:30:36,345 TRACE org.hibernate.type.descriptor.sql.BasicBinder [http-nio-8080-exec-8] binding parameter [1] as [VARCHAR] - [admin]
2025-04-16 01:30:36,346 DEBUG org.hibernate.engine.jdbc.spi.SqlStatementLogger [http-nio-8080-exec-8] 
    select
        userbalanc0_.id as id1_15_0_,
        userbalanc0_.balance as balance2_15_0_,
        userbalanc0_.created_at as created_3_15_0_,
        userbalanc0_.last_deposit_date as last_dep4_15_0_,
        userbalanc0_.last_withdrawal_date as last_wit5_15_0_,
        userbalanc0_.updated_at as updated_6_15_0_,
        userbalanc0_.user_id as user_id7_15_0_ 
    from
        user_balances userbalanc0_ 
    where
        userbalanc0_.user_id=?
2025-04-16 01:30:36,346 TRACE org.hibernate.type.descriptor.sql.BasicBinder [http-nio-8080-exec-8] binding parameter [1] as [BIGINT] - [2]
2025-04-16 01:30:36,347 DEBUG org.hibernate.engine.jdbc.spi.SqlStatementLogger [http-nio-8080-exec-8] 
    select
        roles0_.user_id as user_id1_18_0_,
        roles0_.role_id as role_id2_18_0_,
        role1_.id as id1_14_1_,
        role1_.name as name2_14_1_ 
    from
        user_roles roles0_ 
    inner join
        roles role1_ 
            on roles0_.role_id=role1_.id 
    where
        roles0_.user_id=?
2025-04-16 01:30:36,347 TRACE org.hibernate.type.descriptor.sql.BasicBinder [http-nio-8080-exec-8] binding parameter [1] as [BIGINT] - [2]
2025-04-16 01:30:36,349 DEBUG com.example.tmdt.security.jwt.AuthTokenFilter [http-nio-8080-exec-8] User details loaded for: admin, User class: com.example.tmdt.security.services.UserDetailsImpl
2025-04-16 01:30:36,349 DEBUG com.example.tmdt.security.jwt.AuthTokenFilter [http-nio-8080-exec-8] User authorities: [ROLE_ADMIN]
2025-04-16 01:30:36,349 DEBUG com.example.tmdt.security.jwt.AuthTokenFilter [http-nio-8080-exec-8] Set authentication for user: admin with authorities: [ROLE_ADMIN]
2025-04-16 01:30:36,349 DEBUG com.example.tmdt.security.jwt.AuthTokenFilter [http-nio-8080-exec-8] Authentication set in SecurityContext: UsernamePasswordAuthenticationToken [Principal=com.example.tmdt.security.services.UserDetailsImpl@7f649127, Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=null], Granted Authorities=[ROLE_ADMIN]], Principal class: com.example.tmdt.security.services.UserDetailsImpl
2025-04-16 01:30:36,349 DEBUG org.springframework.security.web.FilterChainProxy$VirtualFilterChain [http-nio-8080-exec-8] Secured PUT /api/chat/sessions/22d50efd-edeb-47b3-a3bc-59661a84f74e/read?currentUserId=2
2025-04-16 01:30:36,350 DEBUG com.example.tmdt.utils.LoggerUtil [http-nio-8080-exec-8] ENTERING markSessionAsRead with args: [22d50efd-edeb-47b3-a3bc-59661a84f74e]
2025-04-16 01:30:36,351 INFO com.example.tmdt.controller.ChatController [http-nio-8080-exec-8] Marking all messages in session 22d50efd-edeb-47b3-a3bc-59661a84f74e as read
2025-04-16 01:30:36,351 INFO com.example.tmdt.service.ChatService [http-nio-8080-exec-8] Marking all messages in session 22d50efd-edeb-47b3-a3bc-59661a84f74e as read
2025-04-16 01:30:36,352 DEBUG org.hibernate.engine.jdbc.spi.SqlStatementLogger [http-nio-8080-exec-8] 
    select
        chatsessio0_.id as id1_3_0_,
        chatsessio0_.ended_at as ended_at2_3_0_,
        chatsessio0_.last_message as last_mes3_3_0_,
        chatsessio0_.started_at as started_4_3_0_,
        chatsessio0_.status as status5_3_0_,
        chatsessio0_.unread_count as unread_c6_3_0_,
        chatsessio0_.user_id as user_id7_3_0_,
        chatsessio0_.user_name as user_nam8_3_0_ 
    from
        chat_sessions chatsessio0_ 
    where
        chatsessio0_.id=?
2025-04-16 01:30:36,352 TRACE org.hibernate.type.descriptor.sql.BasicBinder [http-nio-8080-exec-8] binding parameter [1] as [VARCHAR] - [22d50efd-edeb-47b3-a3bc-59661a84f74e]
2025-04-16 01:30:36,356 DEBUG org.hibernate.engine.jdbc.spi.SqlStatementLogger [http-nio-8080-exec-8] 
    update
        chat_sessions 
    set
        ended_at=?,
        last_message=?,
        started_at=?,
        status=?,
        unread_count=?,
        user_id=?,
        user_name=? 
    where
        id=?
2025-04-16 01:30:36,356 TRACE org.hibernate.type.descriptor.sql.BasicBinder [http-nio-8080-exec-8] binding parameter [1] as [TIMESTAMP] - [null]
2025-04-16 01:30:36,357 TRACE org.hibernate.type.descriptor.sql.BasicBinder [http-nio-8080-exec-8] binding parameter [2] as [VARCHAR] - [Connecting you to a support agent. Please wait a moment...]
2025-04-16 01:30:36,357 TRACE org.hibernate.type.descriptor.sql.BasicBinder [http-nio-8080-exec-8] binding parameter [3] as [TIMESTAMP] - [2025-04-16T01:30:34]
2025-04-16 01:30:36,357 TRACE org.hibernate.type.descriptor.sql.BasicBinder [http-nio-8080-exec-8] binding parameter [4] as [VARCHAR] - [ACTIVE]
2025-04-16 01:30:36,357 TRACE org.hibernate.type.descriptor.sql.BasicBinder [http-nio-8080-exec-8] binding parameter [5] as [INTEGER] - [0]
2025-04-16 01:30:36,358 TRACE org.hibernate.type.descriptor.sql.BasicBinder [http-nio-8080-exec-8] binding parameter [6] as [VARCHAR] - [3]
2025-04-16 01:30:36,358 TRACE org.hibernate.type.descriptor.sql.BasicBinder [http-nio-8080-exec-8] binding parameter [7] as [VARCHAR] - [a1234]
2025-04-16 01:30:36,358 TRACE org.hibernate.type.descriptor.sql.BasicBinder [http-nio-8080-exec-8] binding parameter [8] as [VARCHAR] - [22d50efd-edeb-47b3-a3bc-59661a84f74e]
2025-04-16 01:30:36,360 INFO com.example.tmdt.service.ChatService [http-nio-8080-exec-8] Reset unread count for session 22d50efd-edeb-47b3-a3bc-59661a84f74e
2025-04-16 01:30:36,360 DEBUG org.hibernate.engine.jdbc.spi.SqlStatementLogger [http-nio-8080-exec-8] 
    select
        chatmessag0_.id as id1_2_,
        chatmessag0_.chat_session_id as chat_ses2_2_,
        chatmessag0_.content as content3_2_,
        chatmessag0_.created_at as created_4_2_,
        chatmessag0_.is_read as is_read5_2_,
        chatmessag0_.receiver_id as receiver6_2_,
        chatmessag0_.sender_id as sender_i7_2_,
        chatmessag0_.sender_name as sender_n8_2_,
        chatmessag0_.sender_type as sender_t9_2_ 
    from
        chat_messages chatmessag0_ 
    where
        chatmessag0_.chat_session_id=? 
        and chatmessag0_.is_read=0
2025-04-16 01:30:36,361 TRACE org.hibernate.type.descriptor.sql.BasicBinder [http-nio-8080-exec-8] binding parameter [1] as [VARCHAR] - [22d50efd-edeb-47b3-a3bc-59661a84f74e]
2025-04-16 01:30:36,372 DEBUG org.hibernate.engine.jdbc.spi.SqlStatementLogger [http-nio-8080-exec-8] 
    update
        chat_messages 
    set
        chat_session_id=?,
        content=?,
        created_at=?,
        is_read=?,
        receiver_id=?,
        sender_id=?,
        sender_name=?,
        sender_type=? 
    where
        id=?
2025-04-16 01:30:36,373 TRACE org.hibernate.type.descriptor.sql.BasicBinder [http-nio-8080-exec-8] binding parameter [1] as [VARCHAR] - [22d50efd-edeb-47b3-a3bc-59661a84f74e]
2025-04-16 01:30:36,373 TRACE org.hibernate.type.descriptor.sql.BasicBinder [http-nio-8080-exec-8] binding parameter [2] as [VARCHAR] - [s]
2025-04-16 01:30:36,373 TRACE org.hibernate.type.descriptor.sql.BasicBinder [http-nio-8080-exec-8] binding parameter [3] as [TIMESTAMP] - [2025-04-16T01:30:34]
2025-04-16 01:30:36,373 TRACE org.hibernate.type.descriptor.sql.BasicBinder [http-nio-8080-exec-8] binding parameter [4] as [BOOLEAN] - [true]
2025-04-16 01:30:36,373 TRACE org.hibernate.type.descriptor.sql.BasicBinder [http-nio-8080-exec-8] binding parameter [5] as [VARCHAR] - [null]
2025-04-16 01:30:36,374 TRACE org.hibernate.type.descriptor.sql.BasicBinder [http-nio-8080-exec-8] binding parameter [6] as [VARCHAR] - [3]
2025-04-16 01:30:36,374 TRACE org.hibernate.type.descriptor.sql.BasicBinder [http-nio-8080-exec-8] binding parameter [7] as [VARCHAR] - [a1234]
2025-04-16 01:30:36,374 TRACE org.hibernate.type.descriptor.sql.BasicBinder [http-nio-8080-exec-8] binding parameter [8] as [VARCHAR] - [USER]
2025-04-16 01:30:36,374 TRACE org.hibernate.type.descriptor.sql.BasicBinder [http-nio-8080-exec-8] binding parameter [9] as [BIGINT] - [410]
2025-04-16 01:30:36,376 DEBUG org.hibernate.engine.jdbc.spi.SqlStatementLogger [http-nio-8080-exec-8] 
    update
        chat_messages 
    set
        chat_session_id=?,
        content=?,
        created_at=?,
        is_read=?,
        receiver_id=?,
        sender_id=?,
        sender_name=?,
        sender_type=? 
    where
        id=?
2025-04-16 01:30:36,376 TRACE org.hibernate.type.descriptor.sql.BasicBinder [http-nio-8080-exec-8] binding parameter [1] as [VARCHAR] - [22d50efd-edeb-47b3-a3bc-59661a84f74e]
2025-04-16 01:30:36,376 TRACE org.hibernate.type.descriptor.sql.BasicBinder [http-nio-8080-exec-8] binding parameter [2] as [VARCHAR] - [Connecting you to a support agent. Please wait a moment...]
2025-04-16 01:30:36,377 TRACE org.hibernate.type.descriptor.sql.BasicBinder [http-nio-8080-exec-8] binding parameter [3] as [TIMESTAMP] - [2025-04-16T01:30:34]
2025-04-16 01:30:36,377 TRACE org.hibernate.type.descriptor.sql.BasicBinder [http-nio-8080-exec-8] binding parameter [4] as [BOOLEAN] - [true]
2025-04-16 01:30:36,377 TRACE org.hibernate.type.descriptor.sql.BasicBinder [http-nio-8080-exec-8] binding parameter [5] as [VARCHAR] - [3]
2025-04-16 01:30:36,377 TRACE org.hibernate.type.descriptor.sql.BasicBinder [http-nio-8080-exec-8] binding parameter [6] as [VARCHAR] - [SYSTEM]
2025-04-16 01:30:36,377 TRACE org.hibernate.type.descriptor.sql.BasicBinder [http-nio-8080-exec-8] binding parameter [7] as [VARCHAR] - [System]
2025-04-16 01:30:36,377 TRACE org.hibernate.type.descriptor.sql.BasicBinder [http-nio-8080-exec-8] binding parameter [8] as [VARCHAR] - [SYSTEM]
2025-04-16 01:30:36,377 TRACE org.hibernate.type.descriptor.sql.BasicBinder [http-nio-8080-exec-8] binding parameter [9] as [BIGINT] - [411]
2025-04-16 01:30:36,379 INFO com.example.tmdt.service.ChatService [http-nio-8080-exec-8] Marked 2 messages as read in session 22d50efd-edeb-47b3-a3bc-59661a84f74e
2025-04-16 01:30:36,380 INFO com.example.tmdt.controller.ChatController [http-nio-8080-exec-8] All messages in session 22d50efd-edeb-47b3-a3bc-59661a84f74e marked as read
2025-04-16 01:30:36,380 DEBUG com.example.tmdt.utils.LoggerUtil [http-nio-8080-exec-8] EXITING markSessionAsRead with result: [<200 OK OK,[]>]
2025-04-16 01:30:36,380 DEBUG com.example.tmdt.utils.LoggerUtil [http-nio-8080-exec-8] Method markSessionAsRead executed in 30 ms
2025-04-16 01:30:36,380 DEBUG org.springframework.security.web.context.SecurityContextPersistenceFilter [http-nio-8080-exec-8] Cleared SecurityContextHolder to complete request
2025-04-16 01:30:36,380 INFO com.example.tmdt.filter.RequestLoggingFilter [http-nio-8080-exec-8] RESPONSE: Status=200, Time=38ms
2025-04-16 01:30:38,111 INFO com.example.tmdt.filter.RequestLoggingFilter [http-nio-8080-exec-5] REQUEST: POST /api/chat/messages
2025-04-16 01:30:38,112 INFO com.example.tmdt.filter.RequestLoggingFilter [http-nio-8080-exec-5] HEADERS: host=localhost:8080, connection=keep-alive, content-length=127, sec-ch-ua-platform="Windows", authorization=Bearer eyJhbGciOiJIUzUxMiJ9.eyJzdWIiOiJhZG1pbiIsImlhdCI6MTc0NDczMTMzOSwiZXhwIjoxNzQ0ODE3NzM5fQ.v-t4oABHhkaDi26bHf9oNlBgDITHxwLTyyO6o-6cY9ctKD3wySIuuJ8Ug1erRaTivtrcXJmKE20M5XdQn9Kciw, user-agent=Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/135.0.0.0 Safari/537.36 Edg/135.0.0.0, accept=application/json, text/plain, */*, sec-ch-ua="Microsoft Edge";v="135", "Not-A.Brand";v="8", "Chromium";v="135", content-type=application/json, sec-ch-ua-mobile=?0, origin=http://localhost:3001, sec-fetch-site=same-site, sec-fetch-mode=cors, sec-fetch-dest=empty, referer=http://localhost:3001/, accept-encoding=gzip, deflate, br, zstd, accept-language=en-GB,en;q=0.9,en-US;q=0.8
2025-04-16 01:30:38,112 DEBUG org.springframework.security.web.FilterChainProxy [http-nio-8080-exec-5] Securing POST /api/chat/messages?currentUserId=2
2025-04-16 01:30:38,112 DEBUG org.springframework.security.web.context.SecurityContextPersistenceFilter [http-nio-8080-exec-5] Set SecurityContextHolder to empty SecurityContext
2025-04-16 01:30:38,112 DEBUG com.example.tmdt.security.jwt.AuthTokenFilter [http-nio-8080-exec-5] Processing request to URL: /api/chat/messages, Method: POST
2025-04-16 01:30:38,113 DEBUG com.example.tmdt.security.jwt.AuthTokenFilter [http-nio-8080-exec-5] Authorization header: Bearer eyJhbGciOiJIUzUxMiJ9.eyJzdWIiOiJhZG1pbiIsImlhdCI6MTc0NDczMTMzOSwiZXhwIjoxNzQ0ODE3NzM5fQ.v-t4oABHhkaDi26bHf9oNlBgDITHxwLTyyO6o-6cY9ctKD3wySIuuJ8Ug1erRaTivtrcXJmKE20M5XdQn9Kciw
2025-04-16 01:30:38,113 DEBUG com.example.tmdt.security.jwt.AuthTokenFilter [http-nio-8080-exec-5] Found Authorization header with Bearer token
2025-04-16 01:30:38,113 DEBUG com.example.tmdt.security.jwt.AuthTokenFilter [http-nio-8080-exec-5] Found JWT token in request: eyJhbGciOiJIUzUxMiJ9.eyJzdWIiOiJhZG1pbiIsImlhdCI6MTc0NDczMTMzOSwiZXhwIjoxNzQ0ODE3NzM5fQ.v-t4oABHhkaDi26bHf9oNlBgDITHxwLTyyO6o-6cY9ctKD3wySIuuJ8Ug1erRaTivtrcXJmKE20M5XdQn9Kciw
2025-04-16 01:30:38,113 DEBUG com.example.tmdt.security.jwt.JwtUtils [http-nio-8080-exec-5] JWT token validation successful
2025-04-16 01:30:38,113 DEBUG com.example.tmdt.security.jwt.JwtUtils [http-nio-8080-exec-5] Extracted username from JWT token: admin
2025-04-16 01:30:38,113 DEBUG com.example.tmdt.security.jwt.AuthTokenFilter [http-nio-8080-exec-5] Valid JWT token found for user: admin
2025-04-16 01:30:38,115 DEBUG org.hibernate.engine.jdbc.spi.SqlStatementLogger [http-nio-8080-exec-5] 
    select
        user0_.id as id1_19_,
        user0_.address as address2_19_,
        user0_.email as email3_19_,
        user0_.full_name as full_nam4_19_,
        user0_.password as password5_19_,
        user0_.phone_number as phone_nu6_19_,
        user0_.username as username7_19_ 
    from
        users user0_ 
    where
        user0_.username=?
2025-04-16 01:30:38,115 TRACE org.hibernate.type.descriptor.sql.BasicBinder [http-nio-8080-exec-5] binding parameter [1] as [VARCHAR] - [admin]
2025-04-16 01:30:38,116 DEBUG org.hibernate.engine.jdbc.spi.SqlStatementLogger [http-nio-8080-exec-5] 
    select
        userbalanc0_.id as id1_15_0_,
        userbalanc0_.balance as balance2_15_0_,
        userbalanc0_.created_at as created_3_15_0_,
        userbalanc0_.last_deposit_date as last_dep4_15_0_,
        userbalanc0_.last_withdrawal_date as last_wit5_15_0_,
        userbalanc0_.updated_at as updated_6_15_0_,
        userbalanc0_.user_id as user_id7_15_0_ 
    from
        user_balances userbalanc0_ 
    where
        userbalanc0_.user_id=?
2025-04-16 01:30:38,116 TRACE org.hibernate.type.descriptor.sql.BasicBinder [http-nio-8080-exec-5] binding parameter [1] as [BIGINT] - [2]
2025-04-16 01:30:38,116 DEBUG org.hibernate.engine.jdbc.spi.SqlStatementLogger [http-nio-8080-exec-5] 
    select
        roles0_.user_id as user_id1_18_0_,
        roles0_.role_id as role_id2_18_0_,
        role1_.id as id1_14_1_,
        role1_.name as name2_14_1_ 
    from
        user_roles roles0_ 
    inner join
        roles role1_ 
            on roles0_.role_id=role1_.id 
    where
        roles0_.user_id=?
2025-04-16 01:30:38,117 TRACE org.hibernate.type.descriptor.sql.BasicBinder [http-nio-8080-exec-5] binding parameter [1] as [BIGINT] - [2]
2025-04-16 01:30:38,118 DEBUG com.example.tmdt.security.jwt.AuthTokenFilter [http-nio-8080-exec-5] User details loaded for: admin, User class: com.example.tmdt.security.services.UserDetailsImpl
2025-04-16 01:30:38,118 DEBUG com.example.tmdt.security.jwt.AuthTokenFilter [http-nio-8080-exec-5] User authorities: [ROLE_ADMIN]
2025-04-16 01:30:38,118 DEBUG com.example.tmdt.security.jwt.AuthTokenFilter [http-nio-8080-exec-5] Set authentication for user: admin with authorities: [ROLE_ADMIN]
2025-04-16 01:30:38,118 DEBUG com.example.tmdt.security.jwt.AuthTokenFilter [http-nio-8080-exec-5] Authentication set in SecurityContext: UsernamePasswordAuthenticationToken [Principal=com.example.tmdt.security.services.UserDetailsImpl@7c022763, Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=null], Granted Authorities=[ROLE_ADMIN]], Principal class: com.example.tmdt.security.services.UserDetailsImpl
2025-04-16 01:30:38,118 DEBUG org.springframework.security.web.FilterChainProxy$VirtualFilterChain [http-nio-8080-exec-5] Secured POST /api/chat/messages?currentUserId=2
2025-04-16 01:30:38,119 DEBUG com.example.tmdt.utils.LoggerUtil [http-nio-8080-exec-5] ENTERING saveMessage with args: [{content=d, senderId=2, senderName=admin, senderType=ADMIN, chatSessionId=22d50efd-edeb-47b3-a3bc-59661a84f74e}]
2025-04-16 01:30:38,119 DEBUG com.example.tmdt.controller.ChatController [http-nio-8080-exec-5] Saving message with payload: {content=d, senderId=2, senderName=admin, senderType=ADMIN, chatSessionId=22d50efd-edeb-47b3-a3bc-59661a84f74e}
2025-04-16 01:30:38,120 DEBUG org.hibernate.engine.jdbc.spi.SqlStatementLogger [http-nio-8080-exec-5] 
    select
        count(*) as col_0_0_ 
    from
        chat_sessions chatsessio0_ 
    where
        chatsessio0_.id=?
2025-04-16 01:30:38,121 TRACE org.hibernate.type.descriptor.sql.BasicBinder [http-nio-8080-exec-5] binding parameter [1] as [VARCHAR] - [22d50efd-edeb-47b3-a3bc-59661a84f74e]
2025-04-16 01:30:38,123 DEBUG org.hibernate.engine.jdbc.spi.SqlStatementLogger [http-nio-8080-exec-5] 
    insert 
    into
        chat_messages
        (chat_session_id, content, created_at, is_read, receiver_id, sender_id, sender_name, sender_type) 
    values
        (?, ?, ?, ?, ?, ?, ?, ?)
2025-04-16 01:30:38,123 TRACE org.hibernate.type.descriptor.sql.BasicBinder [http-nio-8080-exec-5] binding parameter [1] as [VARCHAR] - [22d50efd-edeb-47b3-a3bc-59661a84f74e]
2025-04-16 01:30:38,123 TRACE org.hibernate.type.descriptor.sql.BasicBinder [http-nio-8080-exec-5] binding parameter [2] as [VARCHAR] - [d]
2025-04-16 01:30:38,124 TRACE org.hibernate.type.descriptor.sql.BasicBinder [http-nio-8080-exec-5] binding parameter [3] as [TIMESTAMP] - [2025-04-16T01:30:38.123898400]
2025-04-16 01:30:38,124 TRACE org.hibernate.type.descriptor.sql.BasicBinder [http-nio-8080-exec-5] binding parameter [4] as [BOOLEAN] - [false]
2025-04-16 01:30:38,124 TRACE org.hibernate.type.descriptor.sql.BasicBinder [http-nio-8080-exec-5] binding parameter [5] as [VARCHAR] - [null]
2025-04-16 01:30:38,124 TRACE org.hibernate.type.descriptor.sql.BasicBinder [http-nio-8080-exec-5] binding parameter [6] as [VARCHAR] - [2]
2025-04-16 01:30:38,124 TRACE org.hibernate.type.descriptor.sql.BasicBinder [http-nio-8080-exec-5] binding parameter [7] as [VARCHAR] - [admin]
2025-04-16 01:30:38,124 TRACE org.hibernate.type.descriptor.sql.BasicBinder [http-nio-8080-exec-5] binding parameter [8] as [VARCHAR] - [ADMIN]
2025-04-16 01:30:38,126 DEBUG org.hibernate.engine.jdbc.spi.SqlStatementLogger [http-nio-8080-exec-5] 
    select
        chatsessio0_.id as id1_3_0_,
        chatsessio0_.ended_at as ended_at2_3_0_,
        chatsessio0_.last_message as last_mes3_3_0_,
        chatsessio0_.started_at as started_4_3_0_,
        chatsessio0_.status as status5_3_0_,
        chatsessio0_.unread_count as unread_c6_3_0_,
        chatsessio0_.user_id as user_id7_3_0_,
        chatsessio0_.user_name as user_nam8_3_0_ 
    from
        chat_sessions chatsessio0_ 
    where
        chatsessio0_.id=?
2025-04-16 01:30:38,127 TRACE org.hibernate.type.descriptor.sql.BasicBinder [http-nio-8080-exec-5] binding parameter [1] as [VARCHAR] - [22d50efd-edeb-47b3-a3bc-59661a84f74e]
2025-04-16 01:30:38,132 DEBUG org.hibernate.engine.jdbc.spi.SqlStatementLogger [http-nio-8080-exec-5] 
    update
        chat_sessions 
    set
        ended_at=?,
        last_message=?,
        started_at=?,
        status=?,
        unread_count=?,
        user_id=?,
        user_name=? 
    where
        id=?
2025-04-16 01:30:38,133 TRACE org.hibernate.type.descriptor.sql.BasicBinder [http-nio-8080-exec-5] binding parameter [1] as [TIMESTAMP] - [null]
2025-04-16 01:30:38,133 TRACE org.hibernate.type.descriptor.sql.BasicBinder [http-nio-8080-exec-5] binding parameter [2] as [VARCHAR] - [d]
2025-04-16 01:30:38,133 TRACE org.hibernate.type.descriptor.sql.BasicBinder [http-nio-8080-exec-5] binding parameter [3] as [TIMESTAMP] - [2025-04-16T01:30:34]
2025-04-16 01:30:38,133 TRACE org.hibernate.type.descriptor.sql.BasicBinder [http-nio-8080-exec-5] binding parameter [4] as [VARCHAR] - [ACTIVE]
2025-04-16 01:30:38,133 TRACE org.hibernate.type.descriptor.sql.BasicBinder [http-nio-8080-exec-5] binding parameter [5] as [INTEGER] - [1]
2025-04-16 01:30:38,133 TRACE org.hibernate.type.descriptor.sql.BasicBinder [http-nio-8080-exec-5] binding parameter [6] as [VARCHAR] - [3]
2025-04-16 01:30:38,133 TRACE org.hibernate.type.descriptor.sql.BasicBinder [http-nio-8080-exec-5] binding parameter [7] as [VARCHAR] - [a1234]
2025-04-16 01:30:38,133 TRACE org.hibernate.type.descriptor.sql.BasicBinder [http-nio-8080-exec-5] binding parameter [8] as [VARCHAR] - [22d50efd-edeb-47b3-a3bc-59661a84f74e]
2025-04-16 01:30:38,136 INFO com.example.tmdt.service.ChatService [http-nio-8080-exec-5] Updated lastMessage for session 22d50efd-edeb-47b3-a3bc-59661a84f74e: d
2025-04-16 01:30:38,136 INFO com.example.tmdt.controller.ChatController [http-nio-8080-exec-5] Message saved successfully with ID 412
2025-04-16 01:30:38,137 DEBUG com.example.tmdt.utils.LoggerUtil [http-nio-8080-exec-5] EXITING saveMessage with result: [<200 OK OK,ChatMessage(id=412, content=d, senderId=2, senderName=admin, receiverId=null, senderType=ADMIN, chatSessionId=22d50efd-edeb-47b3-a3bc-59661a84f74e, createdAt=2025-04-16T01:30:38.123898400, read=false),[]>]
2025-04-16 01:30:38,137 DEBUG com.example.tmdt.utils.LoggerUtil [http-nio-8080-exec-5] Method saveMessage executed in 18 ms
2025-04-16 01:30:38,137 DEBUG org.springframework.security.web.context.SecurityContextPersistenceFilter [http-nio-8080-exec-5] Cleared SecurityContextHolder to complete request
2025-04-16 01:30:38,137 INFO com.example.tmdt.filter.RequestLoggingFilter [http-nio-8080-exec-5] RESPONSE: Status=200, Time=25ms
2025-04-16 01:30:38,139 INFO com.example.tmdt.websocket.ChatWebSocketHandler [http-nio-8089-exec-59] Received message: {"type":"CHAT_MESSAGE","userId":"2","username":"admin","content":"d","sessionId":"22d50efd-edeb-47b3-a3bc-59661a84f74e","timestamp":1744741838139,"messageId":"f4c32734-6976-461c-808f-82ba70e95bed","savedToDatabase":true,"dbMessageId":412,"senderType":"ADMIN","sender":"admin"}
2025-04-16 01:30:38,139 INFO com.example.tmdt.websocket.ChatWebSocketHandler [http-nio-8089-exec-59] Handling chat message - sender: 2, username: admin, sessionId: 22d50efd-edeb-47b3-a3bc-59661a84f74e, senderType: ADMIN, messageId: f4c32734-6976-461c-808f-82ba70e95bed, content length: 1
2025-04-16 01:30:38,139 INFO com.example.tmdt.websocket.ChatWebSocketHandler [http-nio-8089-exec-59] Message is from an admin: true
2025-04-16 01:30:38,139 INFO com.example.tmdt.websocket.ChatWebSocketHandler [http-nio-8089-exec-59] Admin 2 is sending a message to session: 22d50efd-edeb-47b3-a3bc-59661a84f74e
2025-04-16 01:30:38,139 INFO com.example.tmdt.websocket.ChatWebSocketHandler [http-nio-8089-exec-59] User session found using sessionId 22d50efd-edeb-47b3-a3bc-59661a84f74e: true
2025-04-16 01:30:38,139 INFO com.example.tmdt.websocket.ChatWebSocketHandler [http-nio-8089-exec-59] Sending admin message to user (session: 22d50efd-edeb-47b3-a3bc-59661a84f74e): {"type":"CHAT_MESSAGE","userId":"2","username":"admin","content":"d","timestamp":1744741838139,"sender":"admin","senderType":"ADMIN","sessionId":"22d50efd-edeb-47b3-a3bc-59661a84f74e","messageId":"f4c32734-6976-461c-808f-82ba70e95bed"}
2025-04-16 01:30:38,139 INFO com.example.tmdt.websocket.ChatWebSocketHandler [http-nio-8089-exec-59] Successfully sent admin message to user with session ID: 22d50efd-edeb-47b3-a3bc-59661a84f74e
2025-04-16 01:30:38,139 INFO com.example.tmdt.websocket.ChatWebSocketHandler [http-nio-8089-exec-59] Admin message already saved in database with ID 412, skipping database save
2025-04-16 01:30:42,760 INFO com.example.tmdt.filter.RequestLoggingFilter [http-nio-8080-exec-9] REQUEST: GET /notifications
2025-04-16 01:30:42,760 INFO com.example.tmdt.filter.RequestLoggingFilter [http-nio-8080-exec-3] REQUEST: GET /notifications
2025-04-16 01:30:42,760 INFO com.example.tmdt.filter.RequestLoggingFilter [http-nio-8080-exec-2] REQUEST: GET /notifications/unread-count
2025-04-16 01:30:42,760 INFO com.example.tmdt.filter.RequestLoggingFilter [http-nio-8080-exec-9] HEADERS: host=localhost:8080, connection=keep-alive, sec-ch-ua-platform="Windows", authorization=Bearer eyJhbGciOiJIUzUxMiJ9.eyJzdWIiOiJhZG1pbiIsImlhdCI6MTc0NDczMTMzOSwiZXhwIjoxNzQ0ODE3NzM5fQ.v-t4oABHhkaDi26bHf9oNlBgDITHxwLTyyO6o-6cY9ctKD3wySIuuJ8Ug1erRaTivtrcXJmKE20M5XdQn9Kciw, user-agent=Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/135.0.0.0 Safari/537.36 Edg/135.0.0.0, accept=application/json, text/plain, */*, sec-ch-ua="Microsoft Edge";v="135", "Not-A.Brand";v="8", "Chromium";v="135", sec-ch-ua-mobile=?0, origin=http://localhost:3001, sec-fetch-site=same-site, sec-fetch-mode=cors, sec-fetch-dest=empty, referer=http://localhost:3001/, accept-encoding=gzip, deflate, br, zstd, accept-language=en-GB,en;q=0.9,en-US;q=0.8
2025-04-16 01:30:42,760 INFO com.example.tmdt.filter.RequestLoggingFilter [http-nio-8080-exec-2] HEADERS: host=localhost:8080, connection=keep-alive, sec-ch-ua-platform="Windows", authorization=Bearer eyJhbGciOiJIUzUxMiJ9.eyJzdWIiOiJhMTIzNCIsImlhdCI6MTc0NDY5NDMyNiwiZXhwIjoxNzQ0NzgwNzI2fQ.BdO_Lx19STWajtL_3aPG3UAE47IcXqtg1lV-UsokSSyxYrD8OsPsjBjyrl34GZLD6RHpWE6LJTqDJyQ8OfBUWw, user-agent=Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/135.0.0.0 Safari/537.36 Edg/135.0.0.0, accept=application/json, text/plain, */*, sec-ch-ua="Microsoft Edge";v="135", "Not-A.Brand";v="8", "Chromium";v="135", sec-ch-ua-mobile=?0, origin=http://localhost:3000, sec-fetch-site=same-site, sec-fetch-mode=cors, sec-fetch-dest=empty, referer=http://localhost:3000/, accept-encoding=gzip, deflate, br, zstd, accept-language=en-GB,en;q=0.9,en-US;q=0.8
2025-04-16 01:30:42,760 INFO com.example.tmdt.filter.RequestLoggingFilter [http-nio-8080-exec-3] HEADERS: host=localhost:8080, connection=keep-alive, sec-ch-ua-platform="Windows", authorization=Bearer eyJhbGciOiJIUzUxMiJ9.eyJzdWIiOiJhMTIzNCIsImlhdCI6MTc0NDY5NDMyNiwiZXhwIjoxNzQ0NzgwNzI2fQ.BdO_Lx19STWajtL_3aPG3UAE47IcXqtg1lV-UsokSSyxYrD8OsPsjBjyrl34GZLD6RHpWE6LJTqDJyQ8OfBUWw, user-agent=Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/135.0.0.0 Safari/537.36 Edg/135.0.0.0, accept=application/json, text/plain, */*, sec-ch-ua="Microsoft Edge";v="135", "Not-A.Brand";v="8", "Chromium";v="135", sec-ch-ua-mobile=?0, origin=http://localhost:3000, sec-fetch-site=same-site, sec-fetch-mode=cors, sec-fetch-dest=empty, referer=http://localhost:3000/, accept-encoding=gzip, deflate, br, zstd, accept-language=en-GB,en;q=0.9,en-US;q=0.8
2025-04-16 01:30:42,760 DEBUG org.springframework.security.web.FilterChainProxy [http-nio-8080-exec-2] Securing GET /notifications/unread-count?currentUserId=3
2025-04-16 01:30:42,760 DEBUG org.springframework.security.web.FilterChainProxy [http-nio-8080-exec-3] Securing GET /notifications?currentUserId=3
2025-04-16 01:30:42,760 DEBUG org.springframework.security.web.FilterChainProxy [http-nio-8080-exec-9] Securing GET /notifications?currentUserId=2
2025-04-16 01:30:42,760 DEBUG org.springframework.security.web.context.SecurityContextPersistenceFilter [http-nio-8080-exec-3] Set SecurityContextHolder to empty SecurityContext
2025-04-16 01:30:42,760 DEBUG org.springframework.security.web.context.SecurityContextPersistenceFilter [http-nio-8080-exec-2] Set SecurityContextHolder to empty SecurityContext
2025-04-16 01:30:42,760 DEBUG org.springframework.security.web.context.SecurityContextPersistenceFilter [http-nio-8080-exec-9] Set SecurityContextHolder to empty SecurityContext
2025-04-16 01:30:42,761 DEBUG com.example.tmdt.security.jwt.AuthTokenFilter [http-nio-8080-exec-2] Processing request to URL: /notifications/unread-count, Method: GET
2025-04-16 01:30:42,761 DEBUG com.example.tmdt.security.jwt.AuthTokenFilter [http-nio-8080-exec-3] Processing request to URL: /notifications, Method: GET
2025-04-16 01:30:42,761 DEBUG com.example.tmdt.security.jwt.AuthTokenFilter [http-nio-8080-exec-9] Processing request to URL: /notifications, Method: GET
2025-04-16 01:30:42,761 DEBUG com.example.tmdt.security.jwt.AuthTokenFilter [http-nio-8080-exec-2] Authorization header: Bearer eyJhbGciOiJIUzUxMiJ9.eyJzdWIiOiJhMTIzNCIsImlhdCI6MTc0NDY5NDMyNiwiZXhwIjoxNzQ0NzgwNzI2fQ.BdO_Lx19STWajtL_3aPG3UAE47IcXqtg1lV-UsokSSyxYrD8OsPsjBjyrl34GZLD6RHpWE6LJTqDJyQ8OfBUWw
2025-04-16 01:30:42,761 DEBUG com.example.tmdt.security.jwt.AuthTokenFilter [http-nio-8080-exec-3] Authorization header: Bearer eyJhbGciOiJIUzUxMiJ9.eyJzdWIiOiJhMTIzNCIsImlhdCI6MTc0NDY5NDMyNiwiZXhwIjoxNzQ0NzgwNzI2fQ.BdO_Lx19STWajtL_3aPG3UAE47IcXqtg1lV-UsokSSyxYrD8OsPsjBjyrl34GZLD6RHpWE6LJTqDJyQ8OfBUWw
2025-04-16 01:30:42,761 DEBUG com.example.tmdt.security.jwt.AuthTokenFilter [http-nio-8080-exec-9] Authorization header: Bearer eyJhbGciOiJIUzUxMiJ9.eyJzdWIiOiJhZG1pbiIsImlhdCI6MTc0NDczMTMzOSwiZXhwIjoxNzQ0ODE3NzM5fQ.v-t4oABHhkaDi26bHf9oNlBgDITHxwLTyyO6o-6cY9ctKD3wySIuuJ8Ug1erRaTivtrcXJmKE20M5XdQn9Kciw
2025-04-16 01:30:42,761 DEBUG com.example.tmdt.security.jwt.AuthTokenFilter [http-nio-8080-exec-2] Found Authorization header with Bearer token
2025-04-16 01:30:42,761 DEBUG com.example.tmdt.security.jwt.AuthTokenFilter [http-nio-8080-exec-3] Found Authorization header with Bearer token
2025-04-16 01:30:42,761 DEBUG com.example.tmdt.security.jwt.AuthTokenFilter [http-nio-8080-exec-9] Found Authorization header with Bearer token
2025-04-16 01:30:42,761 DEBUG com.example.tmdt.security.jwt.AuthTokenFilter [http-nio-8080-exec-2] Found JWT token in request: eyJhbGciOiJIUzUxMiJ9.eyJzdWIiOiJhMTIzNCIsImlhdCI6MTc0NDY5NDMyNiwiZXhwIjoxNzQ0NzgwNzI2fQ.BdO_Lx19STWajtL_3aPG3UAE47IcXqtg1lV-UsokSSyxYrD8OsPsjBjyrl34GZLD6RHpWE6LJTqDJyQ8OfBUWw
2025-04-16 01:30:42,761 DEBUG com.example.tmdt.security.jwt.AuthTokenFilter [http-nio-8080-exec-3] Found JWT token in request: eyJhbGciOiJIUzUxMiJ9.eyJzdWIiOiJhMTIzNCIsImlhdCI6MTc0NDY5NDMyNiwiZXhwIjoxNzQ0NzgwNzI2fQ.BdO_Lx19STWajtL_3aPG3UAE47IcXqtg1lV-UsokSSyxYrD8OsPsjBjyrl34GZLD6RHpWE6LJTqDJyQ8OfBUWw
2025-04-16 01:30:42,761 DEBUG com.example.tmdt.security.jwt.AuthTokenFilter [http-nio-8080-exec-9] Found JWT token in request: eyJhbGciOiJIUzUxMiJ9.eyJzdWIiOiJhZG1pbiIsImlhdCI6MTc0NDczMTMzOSwiZXhwIjoxNzQ0ODE3NzM5fQ.v-t4oABHhkaDi26bHf9oNlBgDITHxwLTyyO6o-6cY9ctKD3wySIuuJ8Ug1erRaTivtrcXJmKE20M5XdQn9Kciw
2025-04-16 01:30:42,761 DEBUG com.example.tmdt.security.jwt.JwtUtils [http-nio-8080-exec-2] JWT token validation successful
2025-04-16 01:30:42,761 DEBUG com.example.tmdt.security.jwt.JwtUtils [http-nio-8080-exec-3] JWT token validation successful
2025-04-16 01:30:42,761 DEBUG com.example.tmdt.security.jwt.JwtUtils [http-nio-8080-exec-9] JWT token validation successful
2025-04-16 01:30:42,761 DEBUG com.example.tmdt.security.jwt.JwtUtils [http-nio-8080-exec-2] Extracted username from JWT token: a1234
2025-04-16 01:30:42,761 DEBUG com.example.tmdt.security.jwt.JwtUtils [http-nio-8080-exec-9] Extracted username from JWT token: admin
2025-04-16 01:30:42,761 DEBUG com.example.tmdt.security.jwt.JwtUtils [http-nio-8080-exec-3] Extracted username from JWT token: a1234
2025-04-16 01:30:42,761 DEBUG com.example.tmdt.security.jwt.AuthTokenFilter [http-nio-8080-exec-2] Valid JWT token found for user: a1234
2025-04-16 01:30:42,761 DEBUG com.example.tmdt.security.jwt.AuthTokenFilter [http-nio-8080-exec-9] Valid JWT token found for user: admin
2025-04-16 01:30:42,761 DEBUG com.example.tmdt.security.jwt.AuthTokenFilter [http-nio-8080-exec-3] Valid JWT token found for user: a1234
2025-04-16 01:30:42,762 DEBUG org.hibernate.engine.jdbc.spi.SqlStatementLogger [http-nio-8080-exec-3] 
    select
        user0_.id as id1_19_,
        user0_.address as address2_19_,
        user0_.email as email3_19_,
        user0_.full_name as full_nam4_19_,
        user0_.password as password5_19_,
        user0_.phone_number as phone_nu6_19_,
        user0_.username as username7_19_ 
    from
        users user0_ 
    where
        user0_.username=?
2025-04-16 01:30:42,762 DEBUG org.hibernate.engine.jdbc.spi.SqlStatementLogger [http-nio-8080-exec-9] 
    select
        user0_.id as id1_19_,
        user0_.address as address2_19_,
        user0_.email as email3_19_,
        user0_.full_name as full_nam4_19_,
        user0_.password as password5_19_,
        user0_.phone_number as phone_nu6_19_,
        user0_.username as username7_19_ 
    from
        users user0_ 
    where
        user0_.username=?
2025-04-16 01:30:42,762 DEBUG org.hibernate.engine.jdbc.spi.SqlStatementLogger [http-nio-8080-exec-2] 
    select
        user0_.id as id1_19_,
        user0_.address as address2_19_,
        user0_.email as email3_19_,
        user0_.full_name as full_nam4_19_,
        user0_.password as password5_19_,
        user0_.phone_number as phone_nu6_19_,
        user0_.username as username7_19_ 
    from
        users user0_ 
    where
        user0_.username=?
2025-04-16 01:30:42,763 TRACE org.hibernate.type.descriptor.sql.BasicBinder [http-nio-8080-exec-2] binding parameter [1] as [VARCHAR] - [a1234]
2025-04-16 01:30:42,763 TRACE org.hibernate.type.descriptor.sql.BasicBinder [http-nio-8080-exec-3] binding parameter [1] as [VARCHAR] - [a1234]
2025-04-16 01:30:42,763 TRACE org.hibernate.type.descriptor.sql.BasicBinder [http-nio-8080-exec-9] binding parameter [1] as [VARCHAR] - [admin]
2025-04-16 01:30:42,763 DEBUG org.hibernate.engine.jdbc.spi.SqlStatementLogger [http-nio-8080-exec-9] 
    select
        userbalanc0_.id as id1_15_0_,
        userbalanc0_.balance as balance2_15_0_,
        userbalanc0_.created_at as created_3_15_0_,
        userbalanc0_.last_deposit_date as last_dep4_15_0_,
        userbalanc0_.last_withdrawal_date as last_wit5_15_0_,
        userbalanc0_.updated_at as updated_6_15_0_,
        userbalanc0_.user_id as user_id7_15_0_ 
    from
        user_balances userbalanc0_ 
    where
        userbalanc0_.user_id=?
2025-04-16 01:30:42,763 DEBUG org.hibernate.engine.jdbc.spi.SqlStatementLogger [http-nio-8080-exec-2] 
    select
        userbalanc0_.id as id1_15_0_,
        userbalanc0_.balance as balance2_15_0_,
        userbalanc0_.created_at as created_3_15_0_,
        userbalanc0_.last_deposit_date as last_dep4_15_0_,
        userbalanc0_.last_withdrawal_date as last_wit5_15_0_,
        userbalanc0_.updated_at as updated_6_15_0_,
        userbalanc0_.user_id as user_id7_15_0_ 
    from
        user_balances userbalanc0_ 
    where
        userbalanc0_.user_id=?
2025-04-16 01:30:42,763 DEBUG org.hibernate.engine.jdbc.spi.SqlStatementLogger [http-nio-8080-exec-3] 
    select
        userbalanc0_.id as id1_15_0_,
        userbalanc0_.balance as balance2_15_0_,
        userbalanc0_.created_at as created_3_15_0_,
        userbalanc0_.last_deposit_date as last_dep4_15_0_,
        userbalanc0_.last_withdrawal_date as last_wit5_15_0_,
        userbalanc0_.updated_at as updated_6_15_0_,
        userbalanc0_.user_id as user_id7_15_0_ 
    from
        user_balances userbalanc0_ 
    where
        userbalanc0_.user_id=?
2025-04-16 01:30:42,764 TRACE org.hibernate.type.descriptor.sql.BasicBinder [http-nio-8080-exec-3] binding parameter [1] as [BIGINT] - [3]
2025-04-16 01:30:42,764 TRACE org.hibernate.type.descriptor.sql.BasicBinder [http-nio-8080-exec-9] binding parameter [1] as [BIGINT] - [2]
2025-04-16 01:30:42,764 TRACE org.hibernate.type.descriptor.sql.BasicBinder [http-nio-8080-exec-2] binding parameter [1] as [BIGINT] - [3]
2025-04-16 01:30:42,764 DEBUG org.hibernate.engine.jdbc.spi.SqlStatementLogger [http-nio-8080-exec-9] 
    select
        roles0_.user_id as user_id1_18_0_,
        roles0_.role_id as role_id2_18_0_,
        role1_.id as id1_14_1_,
        role1_.name as name2_14_1_ 
    from
        user_roles roles0_ 
    inner join
        roles role1_ 
            on roles0_.role_id=role1_.id 
    where
        roles0_.user_id=?
2025-04-16 01:30:42,764 DEBUG org.hibernate.engine.jdbc.spi.SqlStatementLogger [http-nio-8080-exec-2] 
    select
        roles0_.user_id as user_id1_18_0_,
        roles0_.role_id as role_id2_18_0_,
        role1_.id as id1_14_1_,
        role1_.name as name2_14_1_ 
    from
        user_roles roles0_ 
    inner join
        roles role1_ 
            on roles0_.role_id=role1_.id 
    where
        roles0_.user_id=?
2025-04-16 01:30:42,764 DEBUG org.hibernate.engine.jdbc.spi.SqlStatementLogger [http-nio-8080-exec-3] 
    select
        roles0_.user_id as user_id1_18_0_,
        roles0_.role_id as role_id2_18_0_,
        role1_.id as id1_14_1_,
        role1_.name as name2_14_1_ 
    from
        user_roles roles0_ 
    inner join
        roles role1_ 
            on roles0_.role_id=role1_.id 
    where
        roles0_.user_id=?
2025-04-16 01:30:42,764 TRACE org.hibernate.type.descriptor.sql.BasicBinder [http-nio-8080-exec-9] binding parameter [1] as [BIGINT] - [2]
2025-04-16 01:30:42,764 TRACE org.hibernate.type.descriptor.sql.BasicBinder [http-nio-8080-exec-2] binding parameter [1] as [BIGINT] - [3]
2025-04-16 01:30:42,764 TRACE org.hibernate.type.descriptor.sql.BasicBinder [http-nio-8080-exec-3] binding parameter [1] as [BIGINT] - [3]
2025-04-16 01:30:42,765 DEBUG com.zaxxer.hikari.pool.HikariPool$PoolEntryCreator [HikariPool-1 connection adder] HikariPool-1 - Added connection com.mysql.cj.jdbc.ConnectionImpl@40254285
2025-04-16 01:30:42,765 DEBUG com.example.tmdt.security.jwt.AuthTokenFilter [http-nio-8080-exec-3] User details loaded for: a1234, User class: com.example.tmdt.security.services.UserDetailsImpl
2025-04-16 01:30:42,765 DEBUG com.example.tmdt.security.jwt.AuthTokenFilter [http-nio-8080-exec-9] User details loaded for: admin, User class: com.example.tmdt.security.services.UserDetailsImpl
2025-04-16 01:30:42,765 DEBUG com.example.tmdt.security.jwt.AuthTokenFilter [http-nio-8080-exec-2] User details loaded for: a1234, User class: com.example.tmdt.security.services.UserDetailsImpl
2025-04-16 01:30:42,765 DEBUG com.example.tmdt.security.jwt.AuthTokenFilter [http-nio-8080-exec-3] User authorities: [ROLE_USER]
2025-04-16 01:30:42,765 DEBUG com.example.tmdt.security.jwt.AuthTokenFilter [http-nio-8080-exec-9] User authorities: [ROLE_ADMIN]
2025-04-16 01:30:42,766 DEBUG com.example.tmdt.security.jwt.AuthTokenFilter [http-nio-8080-exec-2] User authorities: [ROLE_USER]
2025-04-16 01:30:42,766 DEBUG com.example.tmdt.security.jwt.AuthTokenFilter [http-nio-8080-exec-3] Set authentication for user: a1234 with authorities: [ROLE_USER]
2025-04-16 01:30:42,766 DEBUG com.example.tmdt.security.jwt.AuthTokenFilter [http-nio-8080-exec-9] Set authentication for user: admin with authorities: [ROLE_ADMIN]
2025-04-16 01:30:42,766 DEBUG com.example.tmdt.security.jwt.AuthTokenFilter [http-nio-8080-exec-2] Set authentication for user: a1234 with authorities: [ROLE_USER]
2025-04-16 01:30:42,766 DEBUG com.example.tmdt.security.jwt.AuthTokenFilter [http-nio-8080-exec-3] Authentication set in SecurityContext: UsernamePasswordAuthenticationToken [Principal=com.example.tmdt.security.services.UserDetailsImpl@5a712aa8, Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=null], Granted Authorities=[ROLE_USER]], Principal class: com.example.tmdt.security.services.UserDetailsImpl
2025-04-16 01:30:42,766 DEBUG com.example.tmdt.security.jwt.AuthTokenFilter [http-nio-8080-exec-2] Authentication set in SecurityContext: UsernamePasswordAuthenticationToken [Principal=com.example.tmdt.security.services.UserDetailsImpl@378cfedc, Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=null], Granted Authorities=[ROLE_USER]], Principal class: com.example.tmdt.security.services.UserDetailsImpl
2025-04-16 01:30:42,766 DEBUG com.example.tmdt.security.jwt.AuthTokenFilter [http-nio-8080-exec-9] Authentication set in SecurityContext: UsernamePasswordAuthenticationToken [Principal=com.example.tmdt.security.services.UserDetailsImpl@7a8d358d, Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=0:0:0:0:0:0:0:1, SessionId=null], Granted Authorities=[ROLE_ADMIN]], Principal class: com.example.tmdt.security.services.UserDetailsImpl
2025-04-16 01:30:42,766 DEBUG org.springframework.security.web.FilterChainProxy$VirtualFilterChain [http-nio-8080-exec-3] Secured GET /notifications?currentUserId=3
2025-04-16 01:30:42,766 DEBUG org.springframework.security.web.FilterChainProxy$VirtualFilterChain [http-nio-8080-exec-2] Secured GET /notifications/unread-count?currentUserId=3
2025-04-16 01:30:42,766 DEBUG org.springframework.security.web.FilterChainProxy$VirtualFilterChain [http-nio-8080-exec-9] Secured GET /notifications?currentUserId=2
2025-04-16 01:30:42,767 DEBUG org.hibernate.engine.jdbc.spi.SqlStatementLogger [http-nio-8080-exec-9] 
    select
        user0_.id as id1_19_0_,
        user0_.address as address2_19_0_,
        user0_.email as email3_19_0_,
        user0_.full_name as full_nam4_19_0_,
        user0_.password as password5_19_0_,
        user0_.phone_number as phone_nu6_19_0_,
        user0_.username as username7_19_0_,
        roles1_.user_id as user_id1_18_1_,
        role2_.id as role_id2_18_1_,
        role2_.id as id1_14_2_,
        role2_.name as name2_14_2_ 
    from
        users user0_ 
    left outer join
        user_roles roles1_ 
            on user0_.id=roles1_.user_id 
    left outer join
        roles role2_ 
            on roles1_.role_id=role2_.id 
    where
        user0_.id=?
2025-04-16 01:30:42,767 DEBUG org.hibernate.engine.jdbc.spi.SqlStatementLogger [http-nio-8080-exec-2] 
    select
        user0_.id as id1_19_0_,
        user0_.address as address2_19_0_,
        user0_.email as email3_19_0_,
        user0_.full_name as full_nam4_19_0_,
        user0_.password as password5_19_0_,
        user0_.phone_number as phone_nu6_19_0_,
        user0_.username as username7_19_0_,
        roles1_.user_id as user_id1_18_1_,
        role2_.id as role_id2_18_1_,
        role2_.id as id1_14_2_,
        role2_.name as name2_14_2_ 
    from
        users user0_ 
    left outer join
        user_roles roles1_ 
            on user0_.id=roles1_.user_id 
    left outer join
        roles role2_ 
            on roles1_.role_id=role2_.id 
    where
        user0_.id=?
2025-04-16 01:30:42,767 DEBUG org.hibernate.engine.jdbc.spi.SqlStatementLogger [http-nio-8080-exec-3] 
    select
        user0_.id as id1_19_0_,
        user0_.address as address2_19_0_,
        user0_.email as email3_19_0_,
        user0_.full_name as full_nam4_19_0_,
        user0_.password as password5_19_0_,
        user0_.phone_number as phone_nu6_19_0_,
        user0_.username as username7_19_0_,
        roles1_.user_id as user_id1_18_1_,
        role2_.id as role_id2_18_1_,
        role2_.id as id1_14_2_,
        role2_.name as name2_14_2_ 
    from
        users user0_ 
    left outer join
        user_roles roles1_ 
            on user0_.id=roles1_.user_id 
    left outer join
        roles role2_ 
            on roles1_.role_id=role2_.id 
    where
        user0_.id=?
2025-04-16 01:30:42,767 TRACE org.hibernate.type.descriptor.sql.BasicBinder [http-nio-8080-exec-9] binding parameter [1] as [BIGINT] - [2]
2025-04-16 01:30:42,767 TRACE org.hibernate.type.descriptor.sql.BasicBinder [http-nio-8080-exec-2] binding parameter [1] as [BIGINT] - [3]
2025-04-16 01:30:42,767 TRACE org.hibernate.type.descriptor.sql.BasicBinder [http-nio-8080-exec-3] binding parameter [1] as [BIGINT] - [3]
2025-04-16 01:30:42,768 DEBUG org.hibernate.engine.jdbc.spi.SqlStatementLogger [http-nio-8080-exec-3] 
    select
        userbalanc0_.id as id1_15_0_,
        userbalanc0_.balance as balance2_15_0_,
        userbalanc0_.created_at as created_3_15_0_,
        userbalanc0_.last_deposit_date as last_dep4_15_0_,
        userbalanc0_.last_withdrawal_date as last_wit5_15_0_,
        userbalanc0_.updated_at as updated_6_15_0_,
        userbalanc0_.user_id as user_id7_15_0_ 
    from
        user_balances userbalanc0_ 
    where
        userbalanc0_.user_id=?
2025-04-16 01:30:42,768 DEBUG org.hibernate.engine.jdbc.spi.SqlStatementLogger [http-nio-8080-exec-2] 
    select
        userbalanc0_.id as id1_15_0_,
        userbalanc0_.balance as balance2_15_0_,
        userbalanc0_.created_at as created_3_15_0_,
        userbalanc0_.last_deposit_date as last_dep4_15_0_,
        userbalanc0_.last_withdrawal_date as last_wit5_15_0_,
        userbalanc0_.updated_at as updated_6_15_0_,
        userbalanc0_.user_id as user_id7_15_0_ 
    from
        user_balances userbalanc0_ 
    where
        userbalanc0_.user_id=?
2025-04-16 01:30:42,768 DEBUG org.hibernate.engine.jdbc.spi.SqlStatementLogger [http-nio-8080-exec-9] 
    select
        userbalanc0_.id as id1_15_0_,
        userbalanc0_.balance as balance2_15_0_,
        userbalanc0_.created_at as created_3_15_0_,
        userbalanc0_.last_deposit_date as last_dep4_15_0_,
        userbalanc0_.last_withdrawal_date as last_wit5_15_0_,
        userbalanc0_.updated_at as updated_6_15_0_,
        userbalanc0_.user_id as user_id7_15_0_ 
    from
        user_balances userbalanc0_ 
    where
        userbalanc0_.user_id=?
2025-04-16 01:30:42,768 TRACE org.hibernate.type.descriptor.sql.BasicBinder [http-nio-8080-exec-3] binding parameter [1] as [BIGINT] - [3]
2025-04-16 01:30:42,768 TRACE org.hibernate.type.descriptor.sql.BasicBinder [http-nio-8080-exec-9] binding parameter [1] as [BIGINT] - [2]
2025-04-16 01:30:42,768 TRACE org.hibernate.type.descriptor.sql.BasicBinder [http-nio-8080-exec-2] binding parameter [1] as [BIGINT] - [3]
2025-04-16 01:30:42,769 DEBUG org.springframework.security.authorization.method.AuthorizationManagerBeforeMethodInterceptor [http-nio-8080-exec-3] Authorizing method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity com.example.tmdt.controller.NotificationController.getAllNotifications(com.example.tmdt.model.User); target is of class [com.example.tmdt.controller.NotificationController]
2025-04-16 01:30:42,769 DEBUG org.springframework.security.authorization.method.AuthorizationManagerBeforeMethodInterceptor [http-nio-8080-exec-9] Authorizing method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity com.example.tmdt.controller.NotificationController.getAllNotifications(com.example.tmdt.model.User); target is of class [com.example.tmdt.controller.NotificationController]
2025-04-16 01:30:42,769 DEBUG org.springframework.security.authorization.method.AuthorizationManagerBeforeMethodInterceptor [http-nio-8080-exec-2] Authorizing method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity com.example.tmdt.controller.NotificationController.getUnreadCount(com.example.tmdt.model.User); target is of class [com.example.tmdt.controller.NotificationController]
2025-04-16 01:30:42,769 DEBUG org.springframework.security.authorization.method.AuthorizationManagerBeforeMethodInterceptor [http-nio-8080-exec-3] Authorized method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity com.example.tmdt.controller.NotificationController.getAllNotifications(com.example.tmdt.model.User); target is of class [com.example.tmdt.controller.NotificationController]
2025-04-16 01:30:42,769 DEBUG org.springframework.security.authorization.method.AuthorizationManagerBeforeMethodInterceptor [http-nio-8080-exec-2] Authorized method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity com.example.tmdt.controller.NotificationController.getUnreadCount(com.example.tmdt.model.User); target is of class [com.example.tmdt.controller.NotificationController]
2025-04-16 01:30:42,769 DEBUG org.springframework.security.authorization.method.AuthorizationManagerBeforeMethodInterceptor [http-nio-8080-exec-9] Authorized method invocation ReflectiveMethodInvocation: public org.springframework.http.ResponseEntity com.example.tmdt.controller.NotificationController.getAllNotifications(com.example.tmdt.model.User); target is of class [com.example.tmdt.controller.NotificationController]
2025-04-16 01:30:42,769 DEBUG com.example.tmdt.utils.LoggerUtil [http-nio-8080-exec-3] ENTERING getAllNotifications with args: [User(id=3, username=a1234, email=leloilonglon9929@gmail.com, password=$2a$10$IypX/2Nbx/IBYACH0y0g9eu8Kk2rFpLKr/va4tzslF72wpOKDEkTG, fullName=sYn good72, phoneNumber=123, address=a)]
2025-04-16 01:30:42,769 DEBUG com.example.tmdt.utils.LoggerUtil [http-nio-8080-exec-2] ENTERING getUnreadCount with args: [User(id=3, username=a1234, email=leloilonglon9929@gmail.com, password=$2a$10$IypX/2Nbx/IBYACH0y0g9eu8Kk2rFpLKr/va4tzslF72wpOKDEkTG, fullName=sYn good72, phoneNumber=123, address=a)]
2025-04-16 01:30:42,769 DEBUG com.example.tmdt.utils.LoggerUtil [http-nio-8080-exec-9] ENTERING getAllNotifications with args: [User(id=2, username=admin, email=leloilonglon999@gmail.com, password=$2a$10$ppQ9612GD5Rgy6h36K.k1.FDWpk6mfKEk0O6knVrpc2hCfiuTLPRO, fullName=sYn good72, phoneNumber=123, address=a)]
2025-04-16 01:30:42,770 DEBUG org.hibernate.engine.jdbc.spi.SqlStatementLogger [http-nio-8080-exec-3] 
    select
        notificati0_.id as id1_6_,
        notificati0_.created_at as created_2_6_,
        notificati0_.is_read as is_read3_6_,
        notificati0_.message as message4_6_,
        notificati0_.reference_id as referenc5_6_,
        notificati0_.title as title6_6_,
        notificati0_.type as type7_6_,
        notificati0_.user_id as user_id8_6_ 
    from
        notifications notificati0_ 
    where
        notificati0_.user_id=?
2025-04-16 01:30:42,770 DEBUG org.hibernate.engine.jdbc.spi.SqlStatementLogger [http-nio-8080-exec-9] 
    select
        notificati0_.id as id1_6_,
        notificati0_.created_at as created_2_6_,
        notificati0_.is_read as is_read3_6_,
        notificati0_.message as message4_6_,
        notificati0_.reference_id as referenc5_6_,
        notificati0_.title as title6_6_,
        notificati0_.type as type7_6_,
        notificati0_.user_id as user_id8_6_ 
    from
        notifications notificati0_ 
    where
        notificati0_.user_id=?
2025-04-16 01:30:42,770 DEBUG org.hibernate.engine.jdbc.spi.SqlStatementLogger [http-nio-8080-exec-2] 
    select
        count(notificati0_.id) as col_0_0_ 
    from
        notifications notificati0_ 
    where
        notificati0_.user_id=? 
        and notificati0_.is_read=0
2025-04-16 01:30:42,770 TRACE org.hibernate.type.descriptor.sql.BasicBinder [http-nio-8080-exec-9] binding parameter [1] as [BIGINT] - [2]
2025-04-16 01:30:42,770 TRACE org.hibernate.type.descriptor.sql.BasicBinder [http-nio-8080-exec-2] binding parameter [1] as [BIGINT] - [3]
2025-04-16 01:30:42,770 TRACE org.hibernate.type.descriptor.sql.BasicBinder [http-nio-8080-exec-3] binding parameter [1] as [BIGINT] - [3]
2025-04-16 01:30:42,771 DEBUG com.example.tmdt.utils.LoggerUtil [http-nio-8080-exec-2] EXITING getUnreadCount with result: [<200 OK OK,0,[]>]
2025-04-16 01:30:42,771 DEBUG com.example.tmdt.utils.LoggerUtil [http-nio-8080-exec-3] EXITING getAllNotifications with result: [<200 OK OK,[],[]>]
2025-04-16 01:30:42,771 DEBUG com.example.tmdt.utils.LoggerUtil [http-nio-8080-exec-9] EXITING getAllNotifications with result: [<200 OK OK,[],[]>]
2025-04-16 01:30:42,771 DEBUG com.example.tmdt.utils.LoggerUtil [http-nio-8080-exec-2] Method getUnreadCount executed in 2 ms
2025-04-16 01:30:42,771 DEBUG com.example.tmdt.utils.LoggerUtil [http-nio-8080-exec-9] Method getAllNotifications executed in 2 ms
2025-04-16 01:30:42,771 DEBUG com.example.tmdt.utils.LoggerUtil [http-nio-8080-exec-3] Method getAllNotifications executed in 2 ms
2025-04-16 01:30:42,771 DEBUG org.springframework.security.web.context.SecurityContextPersistenceFilter [http-nio-8080-exec-9] Cleared SecurityContextHolder to complete request
2025-04-16 01:30:42,771 DEBUG org.springframework.security.web.context.SecurityContextPersistenceFilter [http-nio-8080-exec-2] Cleared SecurityContextHolder to complete request
2025-04-16 01:30:42,771 DEBUG org.springframework.security.web.context.SecurityContextPersistenceFilter [http-nio-8080-exec-3] Cleared SecurityContextHolder to complete request
2025-04-16 01:30:42,772 INFO com.example.tmdt.filter.RequestLoggingFilter [http-nio-8080-exec-2] RESPONSE: Status=200, Time=12ms
2025-04-16 01:30:42,772 INFO com.example.tmdt.filter.RequestLoggingFilter [http-nio-8080-exec-9] RESPONSE: Status=200, Time=12ms
2025-04-16 01:30:42,772 INFO com.example.tmdt.filter.RequestLoggingFilter [http-nio-8080-exec-3] RESPONSE: Status=200, Time=12ms
2025-04-16 01:30:57,467 DEBUG com.zaxxer.hikari.pool.HikariPool [HikariPool-1 housekeeper] HikariPool-1 - Before cleanup stats (total=4, active=0, idle=4, waiting=0)
2025-04-16 01:30:57,467 DEBUG com.zaxxer.hikari.pool.HikariPool [HikariPool-1 housekeeper] HikariPool-1 - After cleanup  stats (total=4, active=0, idle=4, waiting=0)
2025-04-16 01:30:57,467 DEBUG com.zaxxer.hikari.pool.HikariPool [HikariPool-1 housekeeper] HikariPool-1 - Fill pool skipped, pool is at sufficient level.
2025-04-16 01:31:02,751 INFO org.springframework.core.log.CompositeLog [SpringApplicationShutdownHook] Stopping...
2025-04-16 01:31:02,751 INFO org.springframework.core.log.CompositeLog [SpringApplicationShutdownHook] BrokerAvailabilityEvent[available=false, SimpleBrokerMessageHandler [org.springframework.messaging.simp.broker.DefaultSubscriptionRegistry@4f143176]]
2025-04-16 01:31:02,752 INFO org.springframework.core.log.CompositeLog [SpringApplicationShutdownHook] Stopped.
2025-04-16 01:31:02,776 INFO com.example.tmdt.websocket.ChatWebSocketHandler [SpringApplicationShutdownHook] WebSocket connection closed: 83bb8b9a-fb2f-d437-2916-9a1744c4bdaf with status CloseStatus[code=1001, reason=The web application is stopping]
2025-04-16 01:31:02,777 INFO com.example.tmdt.websocket.ChatWebSocketHandler [SpringApplicationShutdownHook] Found chat session ID 22d50efd-edeb-47b3-a3bc-59661a84f74e for closed WebSocket session
2025-04-16 01:31:02,777 INFO com.example.tmdt.websocket.ChatWebSocketHandler [SpringApplicationShutdownHook] User 3 with session 22d50efd-edeb-47b3-a3bc-59661a84f74e disconnected
2025-04-16 01:31:02,777 INFO com.example.tmdt.websocket.ChatWebSocketHandler [SpringApplicationShutdownHook] Notifying admins that user 3 has disconnected
2025-04-16 01:31:02,777 INFO com.example.tmdt.websocket.ChatWebSocketHandler [SpringApplicationShutdownHook] Current number of admin sessions: 1
2025-04-16 01:31:02,777 INFO com.example.tmdt.websocket.ChatWebSocketHandler [SpringApplicationShutdownHook] Sending USER_DISCONNECTED notification to admin 2: {"type":"USER_DISCONNECTED","userId":"3","timestamp":1744741862777}
2025-04-16 01:31:02,777 INFO com.example.tmdt.websocket.ChatWebSocketHandler [SpringApplicationShutdownHook] Successfully sent user disconnect notification to 1 admin(s)
2025-04-16 01:31:02,778 INFO com.example.tmdt.websocket.ChatWebSocketHandler [SpringApplicationShutdownHook] WebSocket connection closed: 21929e9c-85f9-f44b-005c-92e0bf506f90 with status CloseStatus[code=1001, reason=The web application is stopping]
2025-04-16 01:31:02,778 INFO com.example.tmdt.websocket.ChatWebSocketHandler [SpringApplicationShutdownHook] Found chat session ID 9eb630d7-f522-41bb-9942-7c8f198fe01f for closed WebSocket session
2025-04-16 01:31:02,778 WARN com.example.tmdt.websocket.ChatWebSocketHandler [SpringApplicationShutdownHook] Could not find userId for sessionId 9eb630d7-f522-41bb-9942-7c8f198fe01f on disconnect
2025-04-16 01:31:02,778 INFO com.example.tmdt.websocket.ChatWebSocketHandler [SpringApplicationShutdownHook] WebSocket connection closed: afdf0000-4f3b-35d7-a21d-a74cf29f175d with status CloseStatus[code=1001, reason=The web application is stopping]
2025-04-16 01:31:02,779 WARN com.example.tmdt.websocket.ChatWebSocketHandler [SpringApplicationShutdownHook] Could not identify session type for closed WebSocket session: afdf0000-4f3b-35d7-a21d-a74cf29f175d
2025-04-16 01:31:02,779 INFO com.example.tmdt.websocket.ChatWebSocketHandler [SpringApplicationShutdownHook] WebSocket connection closed: 9a761933-e2a0-6805-4250-0aa97197f957 with status CloseStatus[code=1001, reason=The web application is stopping]
2025-04-16 01:31:02,779 INFO com.example.tmdt.websocket.ChatWebSocketHandler [SpringApplicationShutdownHook] Admin disconnected: 2
2025-04-16 01:31:02,818 INFO org.springframework.orm.jpa.AbstractEntityManagerFactoryBean [SpringApplicationShutdownHook] Closing JPA EntityManagerFactory for persistence unit 'default'
2025-04-16 01:31:02,821 INFO com.zaxxer.hikari.HikariDataSource [SpringApplicationShutdownHook] HikariPool-1 - Shutdown initiated...
2025-04-16 01:31:02,821 DEBUG com.zaxxer.hikari.pool.HikariPool [SpringApplicationShutdownHook] HikariPool-1 - Before shutdown stats (total=4, active=0, idle=4, waiting=0)
2025-04-16 01:31:02,823 DEBUG com.zaxxer.hikari.pool.PoolBase [HikariPool-1 connection closer] HikariPool-1 - Closing connection com.mysql.cj.jdbc.ConnectionImpl@2c154508: (connection evicted)
2025-04-16 01:31:02,829 DEBUG com.zaxxer.hikari.pool.PoolBase [HikariPool-1 connection closer] HikariPool-1 - Closing connection com.mysql.cj.jdbc.ConnectionImpl@41c485ee: (connection evicted)
2025-04-16 01:31:02,829 DEBUG com.zaxxer.hikari.pool.PoolBase [HikariPool-1 connection closer] HikariPool-1 - Closing connection com.mysql.cj.jdbc.ConnectionImpl@1a3c7a2d: (connection evicted)
2025-04-16 01:31:02,830 DEBUG com.zaxxer.hikari.pool.PoolBase [HikariPool-1 connection closer] HikariPool-1 - Closing connection com.mysql.cj.jdbc.ConnectionImpl@40254285: (connection evicted)
2025-04-16 01:31:02,830 DEBUG com.zaxxer.hikari.pool.HikariPool [SpringApplicationShutdownHook] HikariPool-1 - After shutdown stats (total=0, active=0, idle=0, waiting=0)
2025-04-16 01:31:02,830 INFO com.zaxxer.hikari.HikariDataSource [SpringApplicationShutdownHook] HikariPool-1 - Shutdown completed.
